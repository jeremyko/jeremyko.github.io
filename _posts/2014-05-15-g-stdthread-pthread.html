---
layout: post
title: g++ std::thread -pthread option?
date: '2014-05-15T10:47:00.001+09:00'
author: jeremyko
tags:
- cpp
- "-pthread"
- g++
- std::thread
modified_time: '2022-03-26T21:00:43.971+09:00'
thumbnail: http://3.bp.blogspot.com/-qjRXe_QjcVg/U3Qbht4cjOI/AAAAAAAAI4Y/hqE_8-2uzAc/s72-c/%EC%BA%A1%EC%B2%981.PNG
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-1658289456420714993
blogger_orig_url: https://jeremyko.blogspot.com/2014/05/g-stdthread-pthread.html
---

<span style="font-family: Arial, Helvetica, sans-serif;">std::thread 를 이용한 프로그램을 리눅스 환경에서 g++ 을 이용, 컴파일 하는경우 -pthread 옵션이 필요하다.&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">다음과 같은 샘플 프로그램이 있다고 해보자.</span><br /><br /><table border="0" cellpadding="0" cellspacing="0" style="background-color: white; color: black; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; position: relative; z-index: 100;"><tbody><tr><td style="vertical-align: top;"><pre class="textmate-source-numbers" style="color: #999999; font-family: 'Bitstream Vera Sans Mono', Inconsolata, Monaco, Consolas, 'Courier New', monospace; font-size: 11px; line-height: 1.3em; margin-top: 0em; padding-right: 1.25em; text-align: right;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br /></pre></td><td style="vertical-align: top;"><pre class="textmate-source" style="font-family: 'Bitstream Vera Sans Mono', Inconsolata, Monaco, Consolas, 'Courier New', monospace; font-size: 11px; line-height: 1.3em; margin-top: 0em;"><pre class="sunburst" style="font-family: 'Bitstream Vera Sans Mono', Inconsolata, Monaco, Consolas, 'Courier New', monospace; line-height: 1.3em; margin-top: 0em;"><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">//std_thread_test.cpp</span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #008800; font-weight: bold;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #dd2200;">&lt;thread&gt;</span></span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #008800; font-weight: bold;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #dd2200;">&lt;iostream&gt;</span></span><br /><br /><span class="storage storage_type storage_type_c" style="color: #008800; font-weight: bold;">void</span><span class="meta meta_function meta_function_c"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #880000;">thread_func</span><span class="meta meta_parens meta_parens_c">()</span><br /><span class="meta meta_block meta_block_c">{<br />    std::cout&lt;&lt;<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #dd2200;">"hello, I am a thread!"</span>&lt;&lt;std::endl;<br />}</span></span><br /><br /><span class="storage storage_type storage_type_c" style="color: #008800; font-weight: bold;">int</span><span class="meta meta_function meta_function_c"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #880000;">main</span><span class="meta meta_parens meta_parens_c">()</span><br /><span class="meta meta_block meta_block_c">{<br />    std::thread<span class="meta meta_initialization meta_initialization_c"> <span class="variable variable_other variable_other_c" style="color: #003377;">t</span>(</span>thread_func);<br />    t.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c" style="color: #cc0000; font-weight: bold;">join</span>(</span>);<br />}</span></span></pre></pre></td></tr></tbody></table><br /><span style="font-family: Arial, Helvetica, sans-serif;">컴파일시에 다음처럼 -pthread 옵션을 설정해야한다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="color: #45818e; font-family: Arial, Helvetica, sans-serif;">g++ -std=c++11 -pthread -o std_thread_test std_thread_test.cpp</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">옵션을 주지 않는 경우엔 컴파일은 되지만 실행시 core dump가 발생한다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">사용된 g++의 버전은 g++ 4.8.2 으로 c++11 의 기능을 대부분 지원한다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">그렇다면 의문점이 생긴다. c++11 을 지원한다는 g++에 왜 -pthread 란 옵션이 필요한가?</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">언어 차원에서 지원된다는데 왜 pthread 라이브러리 이런게 보이는건지..?</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">좀 생각해보니 spec과 구현의 문제라는걸 알게 되었다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">c++11 의 thread specification 을 g++에서는 기존의 pthread 라이브러리를 사용해서 구현한것일뿐이다.(<strike>이건 사기?</strike>).&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">이건 g++ -v 을 실행해보면 확인할수 있다.</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-qjRXe_QjcVg/U3Qbht4cjOI/AAAAAAAAI4Y/hqE_8-2uzAc/s1600/%EC%BA%A1%EC%B2%981.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-qjRXe_QjcVg/U3Qbht4cjOI/AAAAAAAAI4Y/hqE_8-2uzAc/s1600/%EC%BA%A1%EC%B2%981.PNG" /></a></div><br /><span style="font-family: Arial, Helvetica, sans-serif;">Thread model로 posix 를 사용한다 (좀 허무)</span><br /><br /><br />