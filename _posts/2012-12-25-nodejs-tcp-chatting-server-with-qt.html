---
layout: post
title: node.js chat server with QT client
date: '2012-12-25T22:04:00.006+09:00'
author: jeremyko
tags:
- cpp
- QT
- chat server
- node.js
modified_time: '2022-03-26T21:02:34.350+09:00'
thumbnail: http://3.bp.blogspot.com/-it_m9Jf5yuo/UNma59_kOMI/AAAAAAAACxw/mH68gZv-X4U/s72-c/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.01.33.png
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-3561413527684890061
blogger_orig_url: https://jeremyko.blogspot.com/2012/12/nodejs-tcp-chatting-server-with-qt.html
---

<h2>node.js tcp chatting server with QT client</h2><br />node.js로 구현한 채팅 서버 및 QT로 GUI를 꾸민 클라이언트이다.<br />사용자 등록, 로그인, 대화상대 추가/삭제, 로그인/아웃 알림 및 메시지 전달 기능이 구현되어 있다.<br /><br /><div style="box-sizing: border-box; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; margin-bottom: 15px; margin-top: 15px;"><b>Current features:</b></div><ol style="box-sizing: border-box; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px; margin: 15px 0px; padding: 0px 0px 0px 30px;"><li style="box-sizing: border-box;"><div style="box-sizing: border-box; margin-bottom: 15px; margin-top: 15px;">enroll user</div></li><li style="box-sizing: border-box;"><div style="box-sizing: border-box; margin-bottom: 15px; margin-top: 15px;">add/remove friend</div></li><li style="box-sizing: border-box;"><div style="box-sizing: border-box; margin-bottom: 15px; margin-top: 15px;">login and retrieve my friend list</div></li><li style="box-sizing: border-box;"><div style="box-sizing: border-box; margin-bottom: 15px; margin-top: 15px;">notify logged in/out</div></li><li style="box-sizing: border-box;"><div style="box-sizing: border-box; margin-bottom: 15px; margin-top: 15px;">deliver chat message</div></li></ol><h3>Server</h3>net, Buffer module을 이용해서 작성되었다.&nbsp;클라이언트와 주고받는 패킷의 정의는 다음과 같다.<br /><br /><b>The Packet format is : binary data&nbsp;+ string&nbsp;</b><br /><span style="color: #3d85c6;">4 byte header (means a length of following message)&nbsp;+ message</span><br /><span style="color: #3d85c6;"><br /></span><b>The message format is :</b><br /><span style="color: #3d85c6;">string|(delimiter)...&nbsp;</span><br /><br />제일 먼저 32비트 정수가 포함되고 이후에는 문자열로 구성된 양식이다. 헤더와 메시지를 구분하는 별도 구분은 없다. 문자열의 길이는 이 32비트 정수에 설정 된다.&nbsp;메시지의 형식은 먼저 사용 목적이 나오고 이후 구분자로 구분된 데이터들이 전송된다. 예를 들어 로그인의 경우라면 전달되는 전체 데이터는 다음과 같게 된다.<br /><br /><b>ex) Login message</b><br /><span style="color: #3d85c6;">4byte_integerLOGIN|SomeUserId|SomePassWord~</span><br /><br />즉, 바이너리 데이터와 문자열이 포함되는 형식인데, 결국 다음과 같은 C 구조체가 전송되는 것과 같다.<br /><br /><b>This can be described as a C structure like this :</b><br /><span style="color: #3d85c6;">typedef struct _PACKET_LOGIN</span><br /><span style="color: #3d85c6;">{</span><br /><span style="color: #3d85c6;">&nbsp; &nbsp; unsigned int nLen; //4byte, contains 34</span><br /><span style="color: #3d85c6;">&nbsp; &nbsp; char szMSg [30]; &nbsp; &nbsp;</span><br /><span style="color: #3d85c6;">}&nbsp;PACKET_LOGIN;</span><br /><br />이러한 구조체 데이터에&nbsp;nLen 에는 문자열의 길이 (30)이 설정되고&nbsp;szMSg 에는 "LOGIN|someUserId|SomePassWord~" 문자열이 담겨져서 node.js 서버로 전송되는것과 같다.&nbsp;그러므로 전체 데이터의 길이는 헤더에 설정된 메시지 길이(30 byte)&nbsp;+ 헤더 자체의 길이 (4byte) = 34 byte가 된다.<br /><br />인터넷에서는 echo 서버, 혹은 단순히 클라이언트의 데이터를 받는 즉시 브로드캐스팅하는 예제를 볼수 있다. 하지만&nbsp;tcp의 메시지 경계 없음으로 인한&nbsp;<b>데이터 fragmentation을 고려해줘야</b>&nbsp;제대로 동작하는 서버를 작성할수 있다. 이 때문에 전달되는 데이터가 완전한 하나의 패킷이 될때, 해당 처리를 해주고 만약 기대하는 길이만큼 전송이 다 되지 않았다면, 지금까지 받은 데이터를 누적시키는 작업이 필요하다.<br />전달되는 데이터가 모두 문자열이라면, 일반 변수를 사용해서도 가능하겠지만, 지금 구현하는것은 헤더부분이 32비트 정수형이기 때문에 (즉 바이너리 데이터&nbsp;+ 스트링 의 혼합) 뭔가 다른 방법이 필요하다.&nbsp;이때 node.js 가 제공하는 Buffer 모듈을 사용하면 문자열 데이터 뿐만 아니라, 정수형 데이터도 처리가 가능하다.<br /><br /><a name='more'></a><br /><br />소켓으로 데이터가 전달될때의 처리는 다음과 같다.<br /><br /><div class="allcode" style="background-color: #0c1021; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; overflow: auto; width: 645.9666748046875px;"><table border="0" cellpadding="0" cellspacing="0" style="background-color: transparent; background-position: initial initial; background-repeat: initial initial; position: relative; z-index: 100;"><tbody><tr><td style="vertical-align: top;"><pre class="textmate-source-numbers" style="color: #999999; font-family: Inconsolata, Inconsolata, Monaco, Consolas, 'Courier New', monospace; font-size: 14px; line-height: 1.3em; margin-top: 0em; padding-right: 1.25em; text-align: right;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br /></pre></td><td style="vertical-align: top;"><pre class="textmate-source" style="color: #f8f8f8; font-family: Inconsolata, Inconsolata, Monaco, Consolas, 'Courier New', monospace; font-size: 14px; line-height: 1.3em; margin-top: 0em; padding: 0px; word-wrap: break-word;"><pre class="sunburst" style="font-family: Inconsolata, Inconsolata, Monaco, Consolas, 'Courier New', monospace; line-height: 1.3em; margin-top: 0em;"><span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> accumulatingBuffer <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="meta meta_class meta_class_instance meta_class_instance_constructor" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="keyword keyword_operator keyword_operator_new keyword_operator_new_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">new</span> <span class="entity entity_name entity_name_type entity_name_type_instance entity_name_type_instance_js" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">Buffer</span></span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>; <br /><span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> totalPacketLen   <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">-</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>; <br /><span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> accumulatingLen  <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span>  <span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>;<br /><span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> recvedThisTimeLen<span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span>  <span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>;<br /><br />c<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>on<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="string string_quoted string_quoted_single string_quoted_single_js" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">'data'</span><span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span><span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">function</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>data<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span>        <br />    recvedThisTimeLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> data<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_constant support_constant_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">length</span>;<br />    <span class="entity entity_name entity_name_type entity_name_type_object entity_name_type_object_js entity_name_type_object_js_firebug" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">console</span><span class="support support_function support_function_js support_function_js_firebug" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">.log</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="string string_quoted string_quoted_single string_quoted_single_js" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">'recvedThisTimeLen='</span><span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span> recvedThisTimeLen<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />    <span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> tmpBuffer <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="meta meta_class meta_class_instance meta_class_instance_constructor" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="keyword keyword_operator keyword_operator_new keyword_operator_new_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">new</span> <span class="entity entity_name entity_name_type entity_name_type_instance entity_name_type_instance_js" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">Buffer</span></span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> accumulatingLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span> recvedThisTimeLen <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />    accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>copy<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>tmpBuffer<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />    data<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>copy <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> tmpBuffer<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span>accumulatingLen  <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>; <span class="comment comment_line comment_line_double-slash comment_line_double-slash_js" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// offset for accumulating</span><br />    accumulatingBuffer <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> tmpBuffer; <br />    tmpBuffer <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="constant constant_language constant_language_null constant_language_null_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">null</span>;<br />    accumulatingLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span><span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> recvedThisTimeLen ;<br />    <br />    <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> recvedThisTimeLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;</span> packetHeaderLen <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span>        <br />        <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">return</span>;<br />    <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span> <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">else</span> <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> recvedThisTimeLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">==</span> packetHeaderLen <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span>        <br />        <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">return</span>;<br />    <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span> <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">else</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span>        <br />        <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;</span> <span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span> <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span><br />            totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>readUInt32BE<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> ; <br />            <span class="entity entity_name entity_name_type entity_name_type_object entity_name_type_object_js entity_name_type_object_js_firebug" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">console</span><span class="support support_function support_function_js support_function_js_firebug" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">.log</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="string string_quoted string_quoted_single string_quoted_single_js" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">'totalPacketLen='</span> <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span> totalPacketLen <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span><br />    <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span>    <br /><br />    <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">while</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> accumulatingLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">&gt;=</span> totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span> packetHeaderLen <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span><br />        <span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> aPacketBufExceptHeader <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="meta meta_class meta_class_instance meta_class_instance_constructor" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="keyword keyword_operator keyword_operator_new keyword_operator_new_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">new</span> <span class="entity entity_name entity_name_type entity_name_type_instance entity_name_type_instance_js" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">Buffer</span></span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> totalPacketLen  <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>; <br />        accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>copy<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> aPacketBufExceptHeader<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span><span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span><br />         packetHeaderLen<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span>accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_constant support_constant_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">length</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>; <br />        <br />        <span class="comment comment_line comment_line_double-slash comment_line_double-slash_js" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">////////////////////////////////////////////////////////////////////</span><br />        <span class="comment comment_line comment_line_double-slash comment_line_double-slash_js" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//process packet data</span><br />        <span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> stringData <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> aPacketBufExceptHeader<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_function support_function_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">toString</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        <span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> usage <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> stringData<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_function support_function_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">substring</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span><span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">,</span>stringData<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_function support_function_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">indexOf</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>TCP_DELIMITER<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        <span class="entity entity_name entity_name_type entity_name_type_object entity_name_type_object_js entity_name_type_object_js_firebug" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">console</span><span class="support support_function support_function_js support_function_js_firebug" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">.log</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="string string_quoted string_quoted_double string_quoted_double_js" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"usage: "</span> <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span> usage<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        <span class="comment comment_line comment_line_double-slash comment_line_double-slash_js" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//call handler</span><br />        <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>serverFunctions <span class="meta meta_brace meta_brace_square meta_brace_square_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">[</span>usage<span class="meta meta_brace meta_brace_square meta_brace_square_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">]</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>c<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span>remoteIpPort<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span><br />            stringData<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_function support_function_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">substring</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span><span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span>stringData<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_function support_function_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">indexOf</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>TCP_DELIMITER<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        <span class="comment comment_line comment_line_double-slash comment_line_double-slash_js" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">////////////////////////////////////////////////////////////////////</span><br />                <br />        <span class="storage storage_type storage_type_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">var</span> newBufRebuild <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="meta meta_class meta_class_instance meta_class_instance_constructor" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="keyword keyword_operator keyword_operator_new keyword_operator_new_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">new</span> <span class="entity entity_name entity_name_type entity_name_type_instance entity_name_type_instance_js" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">Buffer</span></span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_constant support_constant_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">length</span> <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        newBufRebuild<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>fill<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>copy<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> newBufRebuild<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span><span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span><br />            totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span> packetHeaderLen<span class="meta meta_delimiter meta_delimiter_object meta_delimiter_object_comma meta_delimiter_object_comma_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">, </span>accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span><span class="support support_constant support_constant_js" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">length</span>  <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br />        <br />        <span class="comment comment_line comment_line_double-slash comment_line_double-slash_js" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//init      </span><br />        accumulatingLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">-</span><span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span>totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">+</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">4</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> ;<br />        accumulatingBuffer <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> newBufRebuild;<br />        newBufRebuild <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="constant constant_language constant_language_null constant_language_null_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">null</span>;<br />        totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">-</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>;<br />                <br />        <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span> accumulatingLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;=</span> packetHeaderLen <span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span>        <br />            <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">return</span>;<br />        <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span> <span class="keyword keyword_control keyword_control_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">else</span> <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">{</span><br />            totalPacketLen <span class="keyword keyword_operator keyword_operator_js" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">=</span> accumulatingBuffer<span class="meta meta_delimiter meta_delimiter_method meta_delimiter_method_period meta_delimiter_method_period_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">.</span>readUInt32BE<span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">(</span><span class="constant constant_numeric constant_numeric_js" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span> ;             <br />        <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span>    <br />    <span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span>     <br /><span class="meta meta_brace meta_brace_curly meta_brace_curly_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">}</span><span class="meta meta_brace meta_brace_round meta_brace_round_js" style="padding-bottom: 0.1em; padding-top: 0.2em;">)</span>;<br /></pre><div></div></pre></td></tr></tbody></table></div><br /><br /><br /><br />Buffer 의 copy 메서드를 사용하여 동적으로 버퍼를 할당하여 데이터를 누적시켰다.<br /><span style="color: #3d85c6;">accumulatingBuffer.readUInt32BE(0)</span> 를 사용하여 4바이트 정수값을 읽어서, 헤더를 제외한 메시지의 길이를 구한다. 네트워크 바이트는 빅엔디언인이기 때문에 xxxBE() 함수를 사용한다. 이후 버퍼에서 실제 문자열 메시지를 읽을때는 헤더길이(4)만큼 offset 을 주고 버퍼에 접근하면 된다. 즉,<br /><br /><span style="color: #3d85c6;">accumulatingBuffer.copy( aPacketBufExceptHeader, 0,&nbsp;</span><br /><span style="color: #3d85c6;">&nbsp; &nbsp; packetHeaderLen, accumulatingBuffer.length); // offset header length</span><br /><br />이부분이 offset만큼 간격을 두고 버퍼에서 메시지 문자열만을 얻기 위한 부분이다.&nbsp;이처럼 일반적인 C언어 구조체와 같은 형식도 node.js Buffer 를 사용하면, 자유롭게 연동이 가능하다.&nbsp;사용자 정보, 대화상대 정보 등은 sqlite 데이터베이스에 저장하는것으로 하였다. 이를 위해 <a href="https://github.com/developmentseed/node-sqlite3" target="_blank">node-sqlite3</a>&nbsp;가 사용 되었다. &nbsp;클라이언트로 데이터 전송시에도 헤더 설정이 필요한데, 이때는&nbsp;<span style="color: #3d85c6;">writeUInt32BE</span> 함수가 사용되었다.<br /><br /><h3><b>Client</b></h3>QT 를 이용하여, 간단한 &nbsp;GUI를 가진 것으로 작성 하였다.&nbsp;node.js서버에서는 클라이언트 요청에 대해 다음과 같이 응답을 해준다. <br /><br /><b>Responses:</b><br />ex) if adding friend is success :<br /><span style="color: #3d85c6;">4byte_headerADDFRIEND|OK|friendid|online</span><br /><br />ex) if adding friend is failure :<br /><span style="color: #3d85c6;">4byte_headerADDFRIEND|FAIL|err-string</span><br /><br />아래 스크린샷과 소스를 참고.<br /><br />소스는 다음에서 다운로드 할수 있다.<br /><a href="https://github.com/jeremyko/nodeChatServer" target="_blank"><span style="color: blue;">https://github.com/jeremyko/nodeChatServer</span></a><br /><a href="https://github.com/jeremyko/nodeChatClient" target="_blank"><span style="color: blue;">https://github.com/jeremyko/nodeChatClient</span></a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-it_m9Jf5yuo/UNma59_kOMI/AAAAAAAACxw/mH68gZv-X4U/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.01.33.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-it_m9Jf5yuo/UNma59_kOMI/AAAAAAAACxw/mH68gZv-X4U/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.01.33.png" height="191" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ZmMXw7aOixs/UNma6ixrTSI/AAAAAAAACx0/EU26vSS6HMA/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.26.02.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ZmMXw7aOixs/UNma6ixrTSI/AAAAAAAACx0/EU26vSS6HMA/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.26.02.png" height="191" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-dndHoypLxn0/UNma7Qw4rUI/AAAAAAAACyE/gL8FlYpZamI/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.26.28.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-dndHoypLxn0/UNma7Qw4rUI/AAAAAAAACyE/gL8FlYpZamI/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.26.28.png" height="191" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ewnIPPDDYQc/UNma8Mf7-rI/AAAAAAAACyM/A5UjzvwZndI/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.26.36.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-ewnIPPDDYQc/UNma8Mf7-rI/AAAAAAAACyM/A5UjzvwZndI/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.26.36.png" height="320" width="277" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-cE6srMjWkbA/UNma8hGlqkI/AAAAAAAACyY/5NBeayN3y2I/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.27.46.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-cE6srMjWkbA/UNma8hGlqkI/AAAAAAAACyY/5NBeayN3y2I/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.27.46.png" height="320" width="277" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-RspS86LrfVs/UNma9WhkDlI/AAAAAAAACyg/Axkz6r5Zr5Q/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.28.26.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-RspS86LrfVs/UNma9WhkDlI/AAAAAAAACyg/Axkz6r5Zr5Q/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.28.26.png" height="320" width="277" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-ghjtwPkqFQk/UNma-CddeGI/AAAAAAAACyo/Q7z3p5FVgXA/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.28.29.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-ghjtwPkqFQk/UNma-CddeGI/AAAAAAAACyo/Q7z3p5FVgXA/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.28.29.png" height="320" width="268" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-9fJ1uxEese0/UNma-_aT2MI/AAAAAAAACyw/e7qFCJHKcZM/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.29.44.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-9fJ1uxEese0/UNma-_aT2MI/AAAAAAAACyw/e7qFCJHKcZM/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.29.44.png" height="175" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ERWTkRM-4vA/UNma_gy_kKI/AAAAAAAACy4/4xs3js-JDVE/s1600/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.30.10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ERWTkRM-4vA/UNma_gy_kKI/AAAAAAAACy4/4xs3js-JDVE/s320/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2012-12-25+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+4.30.10.png" height="320" width="293" /></a></div>