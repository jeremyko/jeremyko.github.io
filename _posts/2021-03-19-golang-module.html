---
layout: post
title: golang module 작성, 타 모듈에서 로컬 테스트 및 배포 개념 정리
date: '2021-03-19T02:06:00.025+09:00'
author: jeremyko
tags:
- golang
modified_time: '2022-03-24T15:03:14.060+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-3508658223351720723
blogger_orig_url: https://jeremyko.blogspot.com/2021/03/golang-module.html
---

<p><span style="font-size: medium;"><b>2022-03-24 update</b><br /></span></p><p><span style="font-size: medium;">go 1.18부터 도입된 workspace 기능을 사용하면 mod replace 를 대체 가능하다&nbsp; <br /></span></p><p><a href="https://jeremyko.blogspot.com/2022/03/golang-118-workspace-mode.html" target="_blank"><span style="font-size: medium;">https://jeremyko.blogspot.com/2022/03/golang-118-workspace-mode.html <br /></span></a></p><p><span style="font-size: medium;">&nbsp;</span></p><p><span style="font-size: medium;">&nbsp;</span></p><p><span style="font-size: medium;">golang 모듈을 만들고 타 모듈에서 사용하는 것을 한번 정리해보았다. <br />내가 만들려고 하는 모듈이 </span><span style="font-size: medium;"><span style="font-size: medium;"><span style="color: #2b00fe;">github.com/jeremyko/my_mod</span></span> 이며, 모듈 폴더는 ~/mydev/my_mod 라고 가정한다.<br /><b><span></span></b></span></p><a name='more'></a><p></p><p><span style="font-size: medium;"><b>작업중인 모듈 폴더에서 go mod init 을 수행한다.</b><br /></span></p><p style="margin-left: 40px; text-align: left;"><span style="font-size: medium;">cd ~/mydev/my_mod<br /><br /><span style="color: #2b00fe;">go mod init github.com/jeremyko/my_mod</span><br /></span></p><p><span style="font-size: medium;"><br />수행하면, 내가 만드는 모듈에서 사용되는 모든 외부 코드들의 의존성(dependency)을 추적하기 위한 용도의 go.mod 이 생성된다. 내용은 다음과 같다.<br /></span></p><p style="margin-left: 40px; text-align: left;"><span style="color: #660000; font-size: medium;">module github.com/jeremyko/my_mod<br />go 1.15</span><span style="font-size: medium;"><br /></span></p><p><span style="font-size: medium;"><br />지금은 내가 만드는 모듈에 대한 정보만 존재하지만, 다른 개발자의 모듈을 import 하는 경우에는 그 의존성 정보들도 추가될것이다.<br />&nbsp;&nbsp; &nbsp;<br /><br /><b>모듈 코드를 작성한다</b>&nbsp;</span></p><p><span style="font-size: medium;">my_mod.go 파일을 생성하고 다음 내용을 추가한다. <!--HTML generated using hilite.me--></span></p><div style="background: rgb(240, 240, 240) none repeat scroll 0% 0%; border-color: gray; border-image: none 100% / 1 / 0 stretch; border-style: solid; border-width: 0.1em 0.1em 0.1em 0.8em; border: medium solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0px;"><span style="color: #007020; font-size: medium; font-weight: bold;">package</span><span style="font-size: medium;"> my_mod<br />       <br /><span style="color: #007020; font-weight: bold;">func</span> MyModTest() <span style="color: #902000;">string</span> {                <br />    <span style="color: #007020; font-weight: bold;">return</span> <span style="color: #4070a0;">"This is from MyModTest in my_mod"</span><br />}<br /></span></pre></div><span style="font-size: medium;">&nbsp; <br /><b>모듈을 사용하는 코드 (모듈)작성</b><br />&nbsp;&nbsp; &nbsp;<br />이제, 내가 작성한 my_mod 를 다른 모듈에서 사용하는 측면에서 살펴본다. 이것은 개발중인 모듈을 로컬에서 테스트 하는 용도로도 활용 될 것이다. main package를 사용하기 위한 용도로 테스트 모듈을 새로 만드는것이다. 이 모듈은 </span><span style="font-size: medium;"><span style="color: #2b00fe; font-size: medium;">github.com/jeremyko/sample&nbsp;</span></span>로 하기로 한다.<span style="font-size: medium;"><span style="color: #2b00fe; font-size: medium;"> </span>이를 위해 sample 디렉토리를 생성하고 이동.<br /></span><p style="margin-left: 40px; text-align: left;"><span style="font-size: medium;">cd ~/mydev<br />mkdir sample<br />cd sample<br /></span></p><p><span style="font-size: medium;"><span style="font-size: medium;">sample 폴더 안에서 다음을 수행한다.<br /></span></span></p><div style="margin-left: 40px; text-align: left;"><span style="color: #2b00fe; font-size: medium;">go mod init github.com/jeremyko/sample</span><span style="font-size: medium;">&nbsp;</span></div><div style="margin-left: 40px; text-align: left;"><span style="font-size: medium;">&nbsp;</span></div><p><span style="font-size: medium;">sample.go 를 새로 만든다.<br /></span>   <span style="font-size: medium;"><!--HTML generated using hilite.me--></span></p><div style="background: rgb(240, 240, 240) none repeat scroll 0% 0%; border-color: gray; border-image: none 100% / 1 / 0 stretch; border-style: solid; border-width: 0.1em 0.1em 0.1em 0.8em; border: medium solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0px;"><span style="color: #007020; font-size: medium; font-weight: bold;">package</span><span style="font-size: medium;"> main<br /><br /><span style="color: #007020; font-weight: bold;">import</span> (<br />    <span style="color: #4070a0;">"fmt"</span><br />    <span style="color: #4070a0;">"github.com/jeremyko/my_mod" //테스트 해 볼 모듈을 import</span><br />)<br /><br /><span style="color: #007020; font-weight: bold;">func</span> main() {<br />    message <span style="color: #666666;">:=</span> my_mod.MyModTest()<br />    fmt.Println(message)<br />}<br /></span></pre></div><span style="font-size: medium;">       &nbsp;&nbsp; &nbsp;<br /></span><p><span style="font-size: medium;">현재 디렉토리 구조는 다음과 같다.<br />&nbsp;&nbsp; &nbsp;<br />jeremyko:~/mydev$ tree<br />.<br /></span></p><p></p><div style="background-color: #121214; display: inline-block; font-family: &quot;D2Coding&quot;, monospace; padding: 4px; white-space: pre;"><span style="background-color: #121214; color: #af9a91; font-size: medium;">├── </span><span style="background-color: #121214; color: #8086ef; font-size: medium;">my_mod<br /></span><span style="background-color: #121214; color: #af9a91; font-size: medium;">│&nbsp;&nbsp; ├── go.mod<br />│&nbsp;&nbsp; └── my_mod.go<br />└── </span><span style="background-color: #121214; color: #8086ef; font-size: medium;">sample<br /></span><span style="background-color: #121214; color: #af9a91; font-size: medium;">    ├── go.mod<br />    └── sample.go</span></div><span style="font-size: medium;"><br /></span><span style="font-size: medium;">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />이제, my_mod 이 배포되어 공개된 모듈이라면 이 상태에서 바로 sample.go 를 실행하면 되겠지만, 지금은 my_mod 모듈이 아직 발행(publish) 되기 전이므로, go 를 사용하여 정식 다운로드를 할수 없다.&nbsp; 즉 github.com/jeremyko/my_mod 와 같은 경로를 현재 사용할수 없다. 그러므로 개발 단계에서는&nbsp; sample.go 를 실행하기 위해서, <span style="background-color: #fcff01;">로컬 위치에서 my_mod 모듈을 찾을수 있게 임시로 조정을 해줘야 한다</span>.<br />&nbsp; &nbsp;<br />이를 위해서는&nbsp;<span style="color: #2b00fe;"> go mod edit</span> 명령을 사용한다. sample 디렉토리 안에서 다음을 실행&nbsp;&nbsp;&nbsp;</span><span style="font-size: medium;">&nbsp;&nbsp; <br /></span><p></p><div style="margin-left: 40px; text-align: left;"><span style="color: #2b00fe; font-size: medium;">go mod edit -replace github.com/jeremyko/my_mod=../my_mod</span><span style="font-size: medium;"><br /></span></div><span style="font-size: medium;"><br />이 명령을 실행하면, go.mod 파일은 다음처럼 변경된다.<br /><br /></span><div style="margin-left: 40px; text-align: left;"><span style="color: #660000; font-size: medium;">module github.com/jeremyko/sample<br />go 1.15<br />replace github.com/jeremyko/my_mod =&gt; ../my_mod</span><span style="font-size: medium;"><br /></span></div><p><span style="font-size: medium;">&nbsp;</span></p><p><span style="font-size: medium;"><b>누락된 모듈을 연결</b></span></p><p><span style="font-size: medium;">sample 모듈이 my_mod 모듈을 사용한다는것을 설정하기 위해 다음을 sample 폴더에서 수행한다. 즉 의존성을 정리하기 위한 명령을 수행하는 것이다. <br /></span></p><p style="margin-left: 40px; text-align: left;"><span style="color: #2b00fe; font-size: medium;">go mod tidy </span><span style="font-size: medium;"><br /></span></p><p><span style="font-size: medium;">명령을 실행하면 로컬에서 my_mod 코드를 찾아서 go.mod 파일에 다음처럼 마지막에 require 지시자가 추가된다. require 지시자는 현재 모듈이 필요로 하는 모듈을 선언하는 용도이다.<br /></span></p><div style="margin-left: 40px; text-align: left;"><span style="color: #660000; font-size: medium;">module github.com/jeremyko/sample<br />go 1.15<br />replace github.com/jeremyko/my_mod =&gt; ../my_mod<br />require github.com/jeremyko/my_mod v0.0.0-00010101000000-000000000000</span><span style="font-size: medium;"><br /></span></div><span style="font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />모듈 경로 다음에 나오는 숫자(v0.0.0-00010101000000-000000000000)는 유사 버전 넘버라고 불리며, 현재 배포되지 않은 모듈을 사용하기 때문에 임시로 생성된 버전 넘버라고 보면 된다. 실제 모듈이 배포가 되는 시점에는 <a href="https://golang.org/doc/modules/version-numbers" target="_blank">공식 버전 관리 지침</a>대로&nbsp; 버전 넘버를 설정해주면 된다. 물론 이 경우에는 <span style="background-color: #fcff01;">replace 지시자 부분은 제거</span>해 줘야 한다.<br />&nbsp;&nbsp;&nbsp; </span><p><span style="font-size: medium;"><b>실행</b></span></p><p><span style="font-size: medium;">sample 폴더에서 다음을 수행하여 결과를 확인한다. <br />&nbsp; <br /></span></p><div style="background-color: #121214; display: inline-block; font-family: &quot;D2Coding&quot;, monospace; padding: 4px; white-space: pre;"><span style="background-color: #121214; color: #d6b04e; font-size: medium;">jeremyko</span><span style="background-color: #121214; color: #af9a91; font-size: medium;">:</span><span style="background-color: #121214; color: #8086ef; font-size: medium;">~/mydev/sample</span><span style="background-color: #121214; color: #af9a91; font-size: medium;">$ go run sample.go<br />This is from MyModTest in my_mod</span><span style="font-size: medium;"><br /></span></div><p><span style="font-size: medium;">&nbsp;</span></p><p><span style="font-size: medium;"><b>배포</b></span></p><span style="font-size: medium;">이제 테스트가 완료된 모듈은 github.com/jeremyko/my_mod 리포지토리에 push 한다. <br /></span><p><span style="color: #660000; font-size: medium;">&nbsp;</span><span style="font-size: medium;"> &nbsp;&nbsp; <br /><b>참고 </b></span><br />&nbsp;&nbsp;&nbsp; <a href="https://golang.org/doc/tutorial/create-module">https://golang.org/doc/tutorial/create-module</a></p><p>&nbsp;&nbsp;&nbsp; <a href="https://golang.org/doc/modules/version-numbers" target="_blank">https://golang.org/doc/modules/version-numbers </a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /></p><p></p><p></p>