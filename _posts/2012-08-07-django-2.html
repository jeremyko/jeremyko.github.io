---
layout: post
title: Django 게시판 만들기 2 - 글쓰기 기능 구현
date: '2012-08-07T17:14:00.003+09:00'
author: jeremyko
tags:
- python
- 게시판
- Django
modified_time: '2014-01-07T13:14:14.698+09:00'
thumbnail: http://1.bp.blogspot.com/-dotAjI7wapk/UCDO1-IEQYI/AAAAAAAAA20/RyP9CGaJ_qU/s72-c/write.jpg
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-4460802572980933894
blogger_orig_url: https://jeremyko.blogspot.com/2012/08/django-2.html
---

<span style="background-color: #fff2cc;"><b>글쓰기 기능 구현</b></span><br /><br />이제 글쓰기 기능을 구현할 차례이다.&nbsp;글쓰기 버튼을 클릭시에 /show_write_form 이 호출되므로, 이 url을 컨트롤러에 맵핑해서 글쓰기 기능을 구현하면 된다. 먼저 /sample_board/view.py파일에 글쓰기를 위한 컨트롤러를 추가한다.<br /><br /><span style="color: #45818e;">def show_write_form(request):</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; return render_to_response('writeBoard.html')</span><br /><br />그리고 dj_board/urls.py 에 다음처럼 추가한다.<br /><br /><span style="color: #45818e;">urlpatterns = patterns('',</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url(r'^$', views.home),</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; <span style="background-color: #fff2cc;">url(r'^show_write_form/$', views.show_write_form),</span></span><br /><span style="color: #45818e;">)</span><br /><br />요청을 받으면 글작성을 위한 템플릿만을 화면에 출력하는 부분이므로 간단하게 처리한다.&nbsp;그럼 이제, writeBoard.html 템플릿을 작성해야 한다. templates 폴더에 writeBoard.html 를 다음처럼 생성한다. form을 이용한 간단한 작성화면이 되겠다.<br /><br /><a name='more'></a><br />&nbsp;<span style="color: #3d85c6;">writeBoard.html</span><br /><span style="color: #3d85c6;">&nbsp; </span><span style="color: #45818e;">&lt;script language="javascript"&gt;</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function writeCheck() {</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var form = document.writeform;</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!form.name.value)</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert("이름을 적어주세요");</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form.name.focus();</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!form.subject.value) {</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert("제목을 적어주세요");</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form.subject.focus();</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!form.memo.value) {</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert("내용을 적어주세요");</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form.memo.focus();</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form.submit();</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br /><span style="color: #45818e;">&nbsp; &lt;/script&gt;</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp; &lt;html&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;head&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;meta http-equiv="Content-Type" content="text/html; charset=EUC-KR"&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;title&gt;게시판 글쓰기&lt;/title&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;/head&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;table width=700 border=1 cellspacing=0 cellpadding=5&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;form name=writeform method=post action="/DoWriteBoard/"&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;tr&gt;&lt;td&gt;&lt;b&gt;이름&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=text name=name size=50&nbsp; maxlength=50&gt;&lt;/td&gt;&lt;/tr&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;tr&gt;&lt;td&gt;&lt;b&gt;이메일&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=text name=email size=50&nbsp; maxlength=50&gt;&lt;/td&gt;&lt;/tr&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;tr&gt;&lt;td&gt;&lt;b&gt;제목&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=text name=subject size=50&nbsp; maxlength=50&gt;&lt;/td&gt;&lt;/tr&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;tr&gt;&lt;td&gt;&lt;b&gt;내용&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;textarea name=memo cols=50 rows=10&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;/form&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;/table&gt;</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp; &lt;table width=700 border=1 cellspacing=0 cellpadding=0&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;tr&gt;&lt;td&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;input type=button value="등록" OnClick="javascript:writeCheck();"&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;/td&gt;&lt;/tr&gt;</span><br /><span style="color: #45818e;">&nbsp; &lt;/table&gt;</span><br /><br />등록 버튼 처리가 /DoWriteBoard/ 에서 이루어지게 했으므로, 마찬가지로 url과 컨트롤러를 맵핑한다. /sample_board/view.py파일에 컨트롤러를 추가한다.<br /><br /><div style="background-color: #fff2cc;"><span style="color: #45818e;">@csrf_exempt</span></div><span style="color: #45818e;">def DoWriteBoard(request):</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; br = DjangoBoard (subject = request.POST['subject'],</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name = request.POST['name'],</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mail = request.POST['email'],</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; memo = request.POST['memo'],</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; created_date = timezone.now(),</span><br /><span style="color: #45818e;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hits = 0</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; br.save()</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; # 저장을 했으니, 다시 조회해서 보여준다.</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url = '/listSpecificPageWork?current_page=1'</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; return HttpResponseRedirect(url)</span><br /><br />그리고 dj_board/urls.py 에 다음처럼 추가한다.<br /><br /><span style="color: #45818e;">urlpatterns = patterns('',</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url(r'^$', views.home),</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url(r'^show_write_form/$', views.show_write_form),</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; <span style="background-color: #fff2cc;">url(r'^DoWriteBoard/$', views.DoWriteBoard),</span></span><br /><span style="color: #45818e;">)</span><br /><br />그런데 여기서 @csrf_exempt 은 무엇일까? django 1.2부터 post로 값을 전송시 CSRF 보안 목적으로 추가된 것이라고 한다. 아무튼 이것이 설정 안되면 오류가 발생하니 따라하기로 하고 상세 내용은 <i><b><a href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/" target="_blank">여기</a></b></i>를 참고하라.&nbsp;데이터를 저장하는것은 위 예제처럼 model 을 이용해서 간단하게 처리할수 있다.&nbsp;POST 전송된 값을 참조하기 위해서 request.POST['subject'] 이런식으로 값을 얻어올수 있다.&nbsp;저장후에 다시 화면을 초기화 시키기 위해서 /listSpecificPageWork url을 사용했다. 그럼 당연히 이 url도 컨트롤러와 맵핑을 해줘야겠다.<br /><br />먼저 컨트롤러에 다음을 추가하고..<br /><br /><span style="color: #45818e;">def listSpecificPageWork(request):</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; current_page = request.GET['current_page']</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; totalCnt = DjangoBoard.objects.all().count()</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; print 'current_page=', current_page</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;<span style="background-color: #fff2cc;"> </span><span style="background-color: #fff2cc; color: #073763;"># 페이지를 가지고 범위 데이터를 조회한다 =&gt; raw SQL 사용함</span></span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; boardList = DjangoBoard.objects.raw('SELECT Z.* FROM(SELECT X.*, ceil( rownum / %s ) as page FROM ( SELECT ID,SUBJECT,NAME, CREATED_DATE, MAIL,MEMO,HITS \</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM SAMPLE_BOARD_DJANGOBOARD&nbsp; ORDER BY ID DESC ) X ) Z WHERE page = %s', [rowsPerPage, current_page])</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; print 'boardList=',boardList, 'count()=', totalCnt</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; <span style="background-color: #fff2cc; color: #073763;"># 전체 페이지를 구해서 전달...</span></span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; pagingHelperIns = pagingHelper();</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; totalPageList = pagingHelperIns.getTotalPageList( totalCnt, rowsPerPage)</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; print 'totalPageList', totalPageList</span><br /><span style="color: #45818e;"><br /></span><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; return render_to_response('listSpecificPage.html', {'boardList': boardList, 'totalCnt': totalCnt,</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'current_page':int(current_page) ,'totalPageList':totalPageList} )</span><br /><br />그리고 dj_board/urls.py 에 다음처럼 추가한다.<br /><br /><span style="color: #45818e;">urlpatterns = patterns('',</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url(r'^$', views.home),</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url(r'^show_write_form/$', views.show_write_form),</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; url(r'^DoWriteBoard/$', views.DoWriteBoard),</span><br /><span style="color: #45818e;">&nbsp;&nbsp;&nbsp; <span style="background-color: #fff2cc;">url(r'^listSpecificPageWork/$', views.listSpecificPageWork),</span></span><br /><span style="color: #45818e;">)</span><br /><br />listSpecificPage.html 템플릿은 앞서 이미 작성했다. 그리고 데이터를 조회할때 model을 이용하지 않고 Raw SQL로 직접 처리하였다.&nbsp;이제 글 작성 버튼을 누르고 글을 써보자.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-dotAjI7wapk/UCDO1-IEQYI/AAAAAAAAA20/RyP9CGaJ_qU/s1600/write.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-dotAjI7wapk/UCDO1-IEQYI/AAAAAAAAA20/RyP9CGaJ_qU/s320/write.jpg" height="185" width="320" /></a></div><br />등록 버튼을 누르면, 전체 목록으로 돌아온다.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-APjHhndN5Xs/UCG2YTu7fTI/AAAAAAAAA3k/QnWSvUcRkNk/s1600/listboard.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-APjHhndN5Xs/UCG2YTu7fTI/AAAAAAAAA3k/QnWSvUcRkNk/s320/listboard.jpg" height="102" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div>글작성과 목록 출력을 구현했다. 이제 목록에서 해당글을 선택시 내용 조회를 위한 기능이 필요하다.<br /><br /><br />이 예제의 전체 소스는 아래에서 받을 수 있다.<br /><b><a href="https://github.com/jeremyko/dj_board">https://github.com/jeremyko/dj_board</a></b><br /><br />이어지는 글 :<br /><h3 class="post-title entry-title" itemprop="name" style="background-color: #fefdfa; color: #d52a33; font-family: Georgia, Utopia, 'Palatino Linotype', Palatino, serif; font-size: 22px; font-weight: normal; margin: 0px; position: relative;"><a href="http://jeremyko.blogspot.kr/2012/08/django.html" target="_blank">Django 게시판 만들기 3 - 글 조회 및 수정, 삭제 기능 구현</a></h3>