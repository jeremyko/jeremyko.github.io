---
layout: post
title: 'Intro to Grand Central Dispatch, Part III: Dispatch Sources'
date: '2011-03-25T18:01:00.000+09:00'
author: jeremyko
tags:
- ios
- GCD
- iphone
modified_time: '2015-09-20T12:30:31.040+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-7813131642846009291
blogger_orig_url: https://jeremyko.blogspot.com/2012/04/intro-to-grand-central-dispatch-part.html
---

<br /><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">원문 :&nbsp;<a href="http://www.mikeash.com/pyblog/friday-qa-2009-09-11-intro-to-grand-central-dispatch-part-iii-dispatch-sources.html" style="color: #909090; text-decoration: none;" target="_blank">www.mikeash.com blog</a></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b>Dispatch Sources</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이벤트를 모니터 하기 위한 객체.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이벤트 발생시, 자동으로 dispatch queue상의 특정 block을 실행한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이벤트 종류는 다음과 같다(GCD in 10.6.0).</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span><b>1.Mach port send right state changes.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>2.Mach port receive right state changes.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>3.External process state change.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>4.File descriptor ready for read.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>5.File descriptor ready for write.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>6.Filesystem node event.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>7.POSIX signal.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>8.Custom timer.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>9.Custom event.</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span class="Apple-tab-span" style="white-space: pre;"><span style="font-family: Arial, helvetica, sans-serif;"> </span></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b>1. Custom event</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; dispatch_source_merge_data 함수를 호출하여&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">자신에게 시그널처리하는</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;경우 발생한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; &nbsp;2가지 종류가 존재 한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span class="Apple-tab-span" style="white-space: pre;"><span style="font-family: Arial, helvetica, sans-serif;"> </span></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span><b>DISPATCH_SOURCE_TYPE_DATA_ADD</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span class="Apple-tab-span" style="white-space: pre;"> </span>DISPATCH_SOURCE_TYPE_DATA_OR</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">Custom event 처리 예:</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span class="Apple-tab-span" style="white-space: pre;"><span style="font-family: Arial, helvetica, sans-serif;"> </span></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">어떠한 작업들의 완료로 진행바를 업데이트하는 작업을 예로 들어보자.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">- source 객체를 생성하고(dispatch_source_create),</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">- 각각의 작업 완료시 호출될 이벤트 핸들러(block/function)을</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; 설정한다</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; (dispatch_source_set_event_handler).</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; 완료 이벤트를 받으면 source객체는 등록된 핸들러(block/function)를</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; 실행해서 진행바를</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; 업데이트 한다. 이 GUI 업데이트 작업은</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;main queue에서 처리되어야 하므로 source생성시</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; dispatch_get_main_queue를 호출했다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">- 프로그레스바 업데이트를 위한 값을 구하는 것은 글로벌 큐에서&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">수행된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; 하나의 작업이 완료될때마다 dispatch_source_merge_data를</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;호출하고 값으로 1을 전달한다. &nbsp; &nbsp;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; dispatch_source_merge_data 호출을&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;하면 source객체의 event handler가 호출된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; 이벤트 핸들러 에서는 dispatch_source_get_data 함수로 값을</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;가져올수있다</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; (호출하면 값은 0으로 reset됨).</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span class="Apple-tab-span" style="white-space: pre;"><span style="font-family: Arial, helvetica, sans-serif;">  </span></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div class="pastie"><div class="allcode" style="border-bottom-color: rgb(221, 221, 221); border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-style: solid; border-top-width: 1px; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; padding-bottom: 5px; padding-left: 10px; padding-right: 10px; padding-top: 5px;"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td style="color: #555555; font-family: 돋움, Dotum; font-size: 12px; line-height: 18px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="textmate-source-numbers" style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; color: #999999; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; padding-right: 12px;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br /></pre></td><td style="color: #555555; font-family: 돋움, Dotum; font-size: 12px; line-height: 18px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="textmate-source" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace;"><pre class="sunburst" style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace;">dispatch_source_t source<br />  =  dispatch_source_create<br />  ( DISPATCH_SOURCE_TYPE_DATA_ADD,<br />   <span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">0</span>,<br />   <span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">0</span>,<br />   dispatch_get_main_queue());<br />   <br /> dispatch_source_set_event_handler(source,<br />     ^{<br />         <span class="meta meta_bracketed meta_bracketed_objc">[progressIndicator <span class="meta meta_function-call meta_function-call_objc"><span class="support support_function support_function_any-method support_function_any-method_objc" style="color: #cc0000; font-weight: bold;">incrementBy:</span> dispatch_source_get_data(source)</span>]</span>;<br />     });      <br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">//dispatch source는 항상 suspended 상태로 시작되기때문에</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">//생성후 이벤트 처리를 윈하면 resume시켜야한다.</span><br />dispatch_resume(source);<br />    <br />dispatch_apply(<span class="meta meta_bracketed meta_bracketed_objc">[array <span class="meta meta_function-call meta_function-call_objc"><span class="support support_function support_function_any-method support_function_any-method_objc" style="color: #cc0000; font-weight: bold;">count</span></span>]</span>, globalQueue,<br />     ^(<span class="support support_type support_type_sys-types support_type_sys-types_c">size_t</span> index) {         <br />         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">// 이부분에서 인덱스로 구한 데이터에 대한 처리 수행</span><br />         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">// .....</span><br />         <br />         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">//하나의 작업 완료후 이벤트 발생.</span><br />         dispatch_source_merge_data(source, <span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">1</span>);<br />     } );<br /></pre></pre></td></tr></tbody></table></div><div class="credit" style="background-attachment: initial; background-clip: initial; background-color: #eeeeee; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-color: rgb(204, 204, 204); border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(204, 204, 204); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(204, 204, 204); border-right-style: solid; border-right-width: 1px; border-top-color: initial; border-top-style: initial; border-top-width: 0px; color: #666666; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 0.7em; padding-bottom: 7px; padding-left: 15px; padding-right: 15px; padding-top: 7px;"><div class="buttons" style="float: right; margin-top: -3px;"><span style="font-family: Arial, helvetica, sans-serif;"><a href="http://pastie.org/pastes/2500389.txt" style="color: #336699; text-decoration: none;"><img src="http://pastie.org/images/view.png" height="20" style="border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;" width="67" /></a></span></div><span style="font-family: Arial, helvetica, sans-serif;"><a href="http://pastie.org/2500389" style="color: #336699; text-decoration: none;">Pastie #2500389</a>&nbsp;linked directly from&nbsp;<a href="http://pastie.org/" style="color: #336699; text-decoration: none;">Pastie</a>.</span></div></div><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">dispatch_source_merge_data 호출을 하면 source객체의&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">event handler가 호출된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">만약 여러번의 호출이 발생하면&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">event handler도 여러번 발생할것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그런데 다음 상황을 고려해보자.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">GUI 업데이트 작업은 메인 큐에서 수행되는데 만약 메인큐를&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">처리하는 메인 쓰레드가&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">다른 작업등으로 인해</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">바쁜 경우, 메인큐의 작업은 지연되고있을 것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이때&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">DISPATCH_SOURCE_TYPE_DATA_ADD 타잎의&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">source 객체인 경우면,&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">처리되지 못하고</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">대기중인 여러 이벤트들은 하나로&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">통합(coalesce) 된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그리고 핸들러에서 사용될 값(dispatch_source_merge_data 호출시&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">넘기는 unsigned long 값)</span><span style="font-family: Arial, helvetica, sans-serif;">은 dispatch_source_merge_data 호출&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">할때 마다 계속 더해진다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이후 메인 쓰레드가&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">처리가능시점이 되면&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">event handler가 한번 호출되면서 그동안 누적된&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">값이</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">전달된다.&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">dispatch_source_get_data 호출을 하면 값은 다시 0으로 초기화된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><b><span style="font-family: Arial, helvetica, sans-serif;">즉, 이벤트가 바로바로 처리 안되는 경우, 이벤트를 계속 누적시키지&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">않고 처리가능</span></b></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><b><span style="font-family: Arial, helvetica, sans-serif;">시점에&nbsp;</span></b><b><span style="font-family: Arial, helvetica, sans-serif;">한번만 처리할수 있게 이벤트를&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">통합하면서 데이터값은 계속 누적시켜 주는 것이다.</span></b></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">하지만 메인 쓰레드가 여유가 있어서 메인 큐에서 바로 바로 가져와&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">처리 가능하다면,</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이벤트 핸들러는 통합처리없이 그때그때마다&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">수행될것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이벤트 통합을 원하지 않는다면 dispatch source를 사용할 필요는 없다.&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">dispatch_async 호출을 하면 된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">dispatch_async 대신 dispatch source를 사용하는 오직 하나의 이유라면&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">바로 이벤트 통합처리 때문이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b>2. Built-In Events &nbsp;</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">기본으로 제공되는 이벤트는 어떤것이 있는지 알아본다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span class="Apple-style-span" style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span class="Apple-style-span" style="font-family: Arial, helvetica, sans-serif;"></span><br /><div class="pastie"><div class="allcode" style="border-bottom-color: rgb(221, 221, 221); border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-style: solid; border-top-width: 1px; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; padding-bottom: 5px; padding-left: 10px; padding-right: 10px; padding-top: 5px;"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td style="color: #555555; font-family: 돋움, Dotum; font-size: 12px; line-height: 18px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="textmate-source-numbers" style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; color: #999999; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; padding-right: 12px;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br /></pre></td><td style="color: #555555; font-family: 돋움, Dotum; font-size: 12px; line-height: 18px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="textmate-source" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace;"><pre class="sunburst" style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace;">DISPATCH_SOURCE_TYPE_READ : file descriptor를 모니터한다.<br /> <br /> dispatch_queue_t globalQueue  =  dispatch_get_global_queue<br />         (DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">0</span>);<br />    <br />    dispatch_source_t stdinSource<br />      = dispatch_source_create  ( DISPATCH_SOURCE_TYPE_READ,<br />        STDIN_FILENO, <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #888888;">//file descriptors</span><br />               <span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">0</span>,<br />        globalQueue );<br />                                <br />    dispatch_source_set_event_handler ( stdinSource,<br />     ^{<br />      <span class="storage storage_type storage_type_c" style="color: #008800; font-weight: bold;">char</span> buf<span class="meta meta_bracketed meta_bracketed_objc">[<span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">1024</span>]</span>;<br />         <span class="storage storage_type storage_type_c" style="color: #008800; font-weight: bold;">int</span> len = read(STDIN_FILENO, buf, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: black;">sizeof</span>(buf));<br />         <span class="keyword keyword_control keyword_control_c" style="color: #008800; font-weight: bold;">if</span>(len &gt; <span class="constant constant_numeric constant_numeric_c" style="color: #0000dd; font-weight: bold;">0</span>)<br />             <span class="support support_function support_function_cocoa" style="color: #cc0000; font-weight: bold;">NSLog</span>(<span class="string string_quoted string_quoted_double string_quoted_double_objc" style="background-color: #fff0f0; color: #dd2200;">@"Got data from stdin: %.*s"</span>, len, buf);<br />     });<br />     <br />    dispatch_resume(stdinSource);<br /></pre></pre></td></tr></tbody></table></div><div class="credit" style="background-attachment: initial; background-clip: initial; background-color: #eeeeee; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-color: rgb(204, 204, 204); border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(204, 204, 204); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(204, 204, 204); border-right-style: solid; border-right-width: 1px; border-top-color: initial; border-top-style: initial; border-top-width: 0px; color: #666666; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 0.7em; padding-bottom: 7px; padding-left: 15px; padding-right: 15px; padding-top: 7px;"><div class="buttons" style="float: right; margin-top: -3px;"><span class="Apple-style-span" style="font-family: Arial, helvetica, sans-serif;"><a href="http://pastie.org/pastes/2500392.txt" style="color: #336699; text-decoration: none;"><img src="http://pastie.org/images/view.png" height="20" style="border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;" width="67" /></a></span></div><span class="Apple-style-span" style="font-family: Arial, helvetica, sans-serif;"><a href="http://pastie.org/2500392" style="color: #336699; text-decoration: none;">Pastie #2500392</a>&nbsp;linked directly from&nbsp;<a href="http://pastie.org/" style="color: #336699; text-decoration: none;">Pastie</a>.</span></div></div><span class="Apple-style-span" style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; &nbsp;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">주의할점은 일기 작업이 완료되었다고 해도 dispatch source가 살아있다면&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">filer 기술자를 close하면 안된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">만약 다른 source 객체에서 동일한&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">파일기술자 번호로&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">생성이 된다면, 그 source 객체는 원하지 않는</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">읽기가&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">발생할것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이경우 dispatch_source_set_cancel_handler 함수를 이용한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">dispatch_source_set_cancel_handler 호출하면서&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">파일기술자를 닫는 핸들러(block)를&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">인자로 주고,</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그후 dispatch_source_cancel 함수를 호출하여 cancel 핸들러가&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">호출되게 할수있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그럼 파일 기술자가 close될것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">좀더 자세한 사항은&nbsp;<a href="http://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man3/dispatch_source_create.3.html" style="color: #909090; text-decoration: none;" target="_blank">apple man 페이지</a>를 참조한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div style="background-color: #d0ff9d; padding-bottom: 10px; padding-left: 10px; padding-right: 10px; padding-top: 10px;"><span style="font-family: Arial, helvetica, sans-serif;">DISPATCH_SOURCE_TYPE_TIMER : 주기적으로 이벤트를 발생시킨다.</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이 타잎은 좀 특별하다. handle/mask 인자없이 생성되며,&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">별도의 dispatch_source_set_timer</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">함수를 이용해서&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">타이머를 설정한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void dispatch_source_set_timer (&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>dispatch_source_t source,</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;">    </span>dispatch_time_t start,</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;">    </span>uint64_t interval,</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;">    </span>uint64_t leeway );</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">leeway:&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>타이머 정확성을 지정한다. 0 이라면 지정된 interval 을 최대한&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">정확하게 지켜달라는 의미.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;">  </span>그외 지정되는 숫자는 그 만큼의 interval&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;증가도 무방하다는 의미이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;">  </span>성능향상 및 파워 소비량을 감소 목적.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><div style="font-family: Tahoma, arial, helvetica, sans-serif;">온전한 내용을 원하신다면 원문을 참조하기 바랍니다...</div></div>