---
layout: post
title: Go 1.16 에서 $GOPATH/src 에서 코드 작성하고 사용하기
date: '2021-04-27T22:13:00.004+09:00'
author: jeremyko
tags:
- golang
- GOPATH
modified_time: '2021-04-27T22:14:54.765+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-1214305953117713434
blogger_orig_url: https://jeremyko.blogspot.com/2021/04/go-116-gopathsrc.html
---

<p>Go 1.16 버전 부터는 기본적으로 module 을 사용하게 변경 되었다. 덕분에 GOPATH&nbsp;<span> 와 상관없이 아무 위치에서든 자신의 소스파일을 작성하면 된다.&nbsp; 그리고 모듈을 사용하기 위한 g</span>o.mod 파일이 반드시 필요하게 되었다.&nbsp; 하지만 1.16 버전에서도 선택적으로 module 사용을 할지 말지 여부를  결정 할 수 있다. 예를 들어 기존 프로젝트 구조가 GOPATH 내 src 를 사용하는 경우등이 해당될수 있다. <span style="background-color: #fff2cc;"></span><br /><span></span></p><a name='more'></a>&nbsp;<p></p><p>이를 위해서는 먼저 shell 의 env 변수를 설정하여 go.mod 가 존재하는 경우에만 모듈 인식 모드로 동작하게 설정한다 (이것은 <span style="background-color: #fff2cc;">1.16 버전 이전에는 기본값</span>이었지만 이제 명시적으로 설정이 필요하다).<br /></p><blockquote><b>export GO111MODULE=auto</b></blockquote>&nbsp;영구적으로 설정을 저장하려면 -w 옵션을 사용한다.<br /><blockquote><b>go env -w GO111MODULE=auto</b></blockquote><p></p><p>go.mod 유무 상관없이 항상 GOPATH 를 참조하게 하려면 off로 설정하면 된다.<br /></p><blockquote><b>export GO111MODULE=off</b></blockquote>이렇게 하면 더이상 모듈 인식이 사용되지 않게 되고, go.mod 파일도 필요하지 않다.&nbsp; <span style="background-color: #fff2cc;"></span><br />(하지만 이 방법도  <span style="background-color: #fff2cc;">Go 1.17 버전부터는 이러한 GO111MODULE 설정은 무시되고 무조건 module 을 사용하게 된다고 하니 그때는 마이그레이션을 해줘야 한다).</span> <br /><p></p><p><b>간단한 테스트를 해보자. 먼저 go env 를 확인해 본다.</b><br /></p><p style="margin-left: 40px; text-align: left;">root:~/go/src/sample&gt; <span style="color: #2b00fe;"><b>go env | egrep 'PATH|GO111MODULE'</b></span><br />GO111MODULE="auto"<br />GOPATH="/root/go"</p><p><b>$GOPATH/src 에서 다음 구조로 만들어 주고 소스코드를 작성한다.</b><br /></p><blockquote>root:~/go/src&gt; tree<br />.<br />└── kojh_test<br />&nbsp;&nbsp;&nbsp; ├── test_lib<br />&nbsp;&nbsp;&nbsp; │&nbsp;&nbsp; └── my_lib.go<br />&nbsp;&nbsp;&nbsp; └── test_main<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; └── main.go</blockquote><br /><br />root:~/go/src&gt; cat <b>kojh_test/test_lib/my_lib.go</b><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: #2b00fe;">package test_lib<br /><br />&nbsp;&nbsp; &nbsp;func MyLibTest() string {<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return "This is from MyLibTest in test_lib"<br />&nbsp;&nbsp; &nbsp;}</span> <p></p><p><br />root:~/go/src&gt; cat <b>kojh_test/test_main/main.go</b><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: #2b00fe;">package main<br /><br />&nbsp;&nbsp; &nbsp;import (<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;"fmt"<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;"kojh_test/test_lib"<br />&nbsp;&nbsp; &nbsp;)<br /><br />&nbsp;&nbsp; &nbsp;func main() {<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;message := test_lib.MyLibTest()<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fmt.Println(message)<br />&nbsp;&nbsp; &nbsp;}</span><br /><br /><b>my_lib.go 를  빌드한다.</b><br /><br />root:~/go/src/kojh_test/test_lib&gt; <b>go build kojh_test/test_lib</b><br /></p><p><b>&nbsp;</b></p><p><b>main.go 를 install 한다.&nbsp;</b></p><p><b>&nbsp;</b><br />root:~/go/src/kojh_test/test_main&gt; <b>go install kojh_test/test_main</b><br /><br /><b>실행해 본다.</b><br /><br />root:~/go/bin&gt;<b> ./test_main</b><br />This is from MyLibTest in test_lib<br /><br /><b>참고</b>&nbsp;</p><p><a href="https://golang.org/doc/gopath_code" target="_blank">https://golang.org/doc/gopath_code</a></p><p><a href="https://blog.golang.org/go116-module-changes" target="_blank">https://blog.golang.org/go116-module-changes</a><br /><br /></p><span><!--more--></span><span><!--more--></span><span><!--more--></span>