---
layout: post
title: 'c++ expression tree '
date: '2014-03-13T19:20:00.003+09:00'
author: jeremyko
tags:
- cpp
- 수식트리
modified_time: '2022-03-26T21:01:33.930+09:00'
thumbnail: http://3.bp.blogspot.com/-VxDPdQob44o/UyKwbE9XORI/AAAAAAAAI0I/wfIfFY07QjQ/s72-c/expression_tree_plain.png
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-3156913092191625085
blogger_orig_url: https://jeremyko.blogspot.com/2014/03/c-expression-tree.html
---

<span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <a href="https://github.com/jeremyko/expression-tree-with-user-functions" target="_blank"><span style="font-family: Arial, Helvetica, sans-serif;">https://github.com/jeremyko/expression-tree-with-user-functions</span></a><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <span style="font-family: Arial, Helvetica, sans-serif;">C++ 로 작성된, 사용자가 정의한 함수를 &nbsp;사용할수 있게한 수식트리.&nbsp;</span><br /><br /><a name='more'></a><br />간단한 사칙연산 수식의 경우엔 이미 공개된 소스가 많지만, 좀 더 복잡한 경우에 적용불가하므로 한번 작성해보았다. 사용자가 입력하는 infix 수식을 &nbsp;postfix로 변환 후, 이를 가지고 수식트리를 생성하게 된다. 다음과 같은 간단한 사칙연산의 경우엔<br /><b><span style="color: #45818e;"><br /></span></b><b><span style="color: #45818e;">'A'+'B'+'C'='ABC'</span></b><br /><b><span style="color: #45818e;"><br /></span></b>다음처럼 수식트리가 구성될것이다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-VxDPdQob44o/UyKwbE9XORI/AAAAAAAAI0I/wfIfFY07QjQ/s1600/expression_tree_plain.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-VxDPdQob44o/UyKwbE9XORI/AAAAAAAAI0I/wfIfFY07QjQ/s1600/expression_tree_plain.png" /></a></div><br />그런데 좀더 복잡한 경우, 예를 들어서 <b><span style="color: #45818e;">'1' + StrCat3('A','B','C') = '1ABC'</span></b> 라는 수식이 있다고 가정해보자. 여기서 StrCat3 은 사용자가 임의로 작성한 함수이다.이 함수는 어떤식으로 트리에 표현하면 될까..?<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-hTuqBy8WRiY/UyKwbEVDJVI/AAAAAAAAI0g/st2gQkdCumY/s1600/expression_tree_question.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-hTuqBy8WRiY/UyKwbEVDJVI/AAAAAAAAI0g/st2gQkdCumY/s1600/expression_tree_question.png" /></a></div>이 코드에서는 약간 변형된 이진트리를 사용했는데, 피 연산되는 오른쪽 노드가 list를 가지고, 동적으로 함수 인자를 할당, 추가하는 방식으로 구현됬다.<br />위의 수식 <span style="color: #0c343d;">'1' + StrCat3('A','B','C') = '1ABC'</span> 경우엔 다음처럼 트리가 구성된다.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-IfvvgCbvK8E/UyKydeZFAKI/AAAAAAAAI0s/8i05tOilU2U/s1600/expression_tree_func1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-IfvvgCbvK8E/UyKydeZFAKI/AAAAAAAAI0s/8i05tOilU2U/s1600/expression_tree_func1.png" /></a></div><br /><br />함수내에 함수들이 중첩되는 좀더 복잡한 경우를 생각해보자.<br /><br /><b><span style="color: #134f5c;">'1' + &nbsp;StrCat3('A', 'B', StrCat3('C','D','E')) = '1ABCDE'</span></b><br /><b><span style="color: #134f5c;"><br /></span></b>이경우에 구성되는 트리는 다음과 같다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-HL6czg93myQ/UyKydT1SDVI/AAAAAAAAI0w/u1ftNl4w1DQ/s1600/expression_tree_func2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-HL6czg93myQ/UyKydT1SDVI/AAAAAAAAI0w/u1ftNl4w1DQ/s1600/expression_tree_func2.png" height="252" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><br />만약 어떤 함수가 인자를 하나도 갖지 않는 경우엔 어떻게 될까.<br /><br /><span style="color: #134f5c;"><b>100 = GetInt100()</b></span><br /><b><span style="color: #134f5c;"><br /></span></b>이 경우에 구성되는 트리는 다음과 같다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ZTB5XijbYrY/UyRJeS9zRYI/AAAAAAAAI2w/6-EguNrs0Eo/s1600/expression_tree_func3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-ZTB5XijbYrY/UyRJeS9zRYI/AAAAAAAAI2w/6-EguNrs0Eo/s1600/expression_tree_func3.png" /></a></div><br />이진 트리를 만들기 위해 NULL 자식을 추가했다.<br /><br />트리를 평가해서 결과를 구하기 위해서는 스택이 넘치는것을 방지 하기 위해서 비 재귀적인 방법으로 처리를 했다. 그런데 함수 인자를 위해 추가된 노드를 위해서는, 일반적 후위순회 처리에 추가해서, 동적으로 할당된 함수의 인자 노드까지 모두 순회하게 처리해줘야 한다.<br />이 부분에서는 재귀적인 방법으로 처리를 하고 있는데,먼저 해당 노드의 right-&gt;rightSiblingForMore2funcArgs 을 처리하고, 이후 rightSiblingForMore2funcArgs 을 처리하면 된다.<br /><h1 style="border-bottom-color: rgb(221, 221, 221); border-bottom-style: solid; border-bottom-width: 1px; box-sizing: border-box; color: #333333; cursor: text; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 2.5em; line-height: 1.7; margin: 1em 0px 15px; padding: 0px; position: relative;">Usage</h1><div><h2 style="border-bottom-color: rgb(238, 238, 238); border-bottom-style: solid; border-bottom-width: 1px; box-sizing: border-box; color: #333333; cursor: text; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 2em; line-height: 1.7; margin: 1em 0px 15px; padding: 0px; position: relative;">general arithmetic</h2><div class="highlight highlight-cpp" style="background-color: white; box-sizing: border-box; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(221, 221, 221); box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; line-height: 19px; margin-bottom: 15px; margin-top: 15px; overflow: auto; padding: 6px 10px; word-wrap: normal;"><span class="n" style="box-sizing: border-box;">ExpressionTree</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">;</span><br /><span class="n" style="box-sizing: border-box;">expression_result</span><span class="o" style="box-sizing: border-box; font-weight: bold;">*</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="p" style="box-sizing: border-box;">;</span><br /><span class="kt" style="box-sizing: border-box; color: #445588; font-weight: bold;">bool</span> <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">false</span><span class="p" style="box-sizing: border-box;">;</span><br /><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetInfixExpression</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"1 * -2 "</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="k" style="box-sizing: border-box; font-weight: bold;">if</span> <span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">)</span><br /><span class="p" style="box-sizing: border-box;">{</span><br />   <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span><span class="p" style="box-sizing: border-box;">();</span><br />   <span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br />   <span class="n" style="box-sizing: border-box;">pExpressionRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetResult</span><span class="p" style="box-sizing: border-box;">();</span><br />   <span class="n" style="box-sizing: border-box;">cout</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"expTree.EvaluateExpression returns :"</span> <br />        <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultLong</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="se" style="box-sizing: border-box; color: #dd1144;">\n</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="p" style="box-sizing: border-box;">;</span><br />   <span class="n" style="box-sizing: border-box;">EXPECT_EQ</span><span class="p" style="box-sizing: border-box;">(</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultLong</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="p" style="box-sizing: border-box;">}</span><br /></pre></div><h2 style="border-bottom-color: rgb(238, 238, 238); border-bottom-style: solid; border-bottom-width: 1px; box-sizing: border-box; color: #333333; cursor: text; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 2em; line-height: 1.7; margin: 1em 0px 15px; padding: 0px; position: relative;"><a class="anchor" href="https://github.com/jeremyko/expression-tree-with-user-functions#custom-user-functions" name="custom-user-functions" style="bottom: 0px; box-sizing: border-box; color: #4183c4; cursor: pointer; display: block; left: 0px; margin-left: -30px; padding-left: 30px; padding-right: 6px; position: absolute; text-decoration: none; top: 0px;"></a>custom user functions</h2><div class="highlight highlight-cpp" style="background-color: white; box-sizing: border-box; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(221, 221, 221); box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; line-height: 19px; margin-bottom: 15px; margin-top: 15px; overflow: auto; padding: 6px 10px; word-wrap: normal;"><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//see user_functions.h, user_functions.cpp</span><br /><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//-----------------------------------------------------</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetInfixExpression</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"SumInt4(SumInt4(1,1+1,1+1,2), 1+1, 1+1, 1+1)"</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span><span class="p" style="box-sizing: border-box;">();</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">pExpressionRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetResult</span><span class="p" style="box-sizing: border-box;">();</span><br /><span class="n" style="box-sizing: border-box;">cout</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"expTree.EvaluateExpression returns :"</span> <br />     <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultLong</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="se" style="box-sizing: border-box; color: #dd1144;">\n</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="p" style="box-sizing: border-box;">;</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_EQ</span><span class="p" style="box-sizing: border-box;">(</span><span class="mi" style="box-sizing: border-box; color: #009999;">13</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultLong</span><span class="p" style="box-sizing: border-box;">);</span><br /><br /><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//-----------------------------------------------------</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetInfixExpression</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"GetBool('1'='1')"</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span><span class="p" style="box-sizing: border-box;">();</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><br /><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//-----------------------------------------------------</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetInfixExpression</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"StrCat('ab','cd')=StrCat('a','b')+StrCat('c','d') "</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span><span class="p" style="box-sizing: border-box;">();</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><br /><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//-----------------------------------------------------</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetInfixExpression</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"StrCat3('1','2',StrCat3('a','b',StrCat3('X','Y','Z')) )"</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span><span class="p" style="box-sizing: border-box;">();</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">bRslt</span><span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_EQ</span><span class="p" style="box-sizing: border-box;">(</span><span class="mi" style="box-sizing: border-box; color: #009999;">4</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetDepth</span><span class="p" style="box-sizing: border-box;">());</span><br /><span class="n" style="box-sizing: border-box;">pExpressionRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetResult</span><span class="p" style="box-sizing: border-box;">();</span><br /><span class="n" style="box-sizing: border-box;">cout</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"expTree.EvaluateExpression returns :"</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">strResult</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="se" style="box-sizing: border-box; color: #dd1144;">\n</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="p" style="box-sizing: border-box;">;</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_STREQ</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"12abXYZ"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">strResult</span><span class="p" style="box-sizing: border-box;">);</span><br /></pre></div><h2 style="border-bottom-color: rgb(238, 238, 238); border-bottom-style: solid; border-bottom-width: 1px; box-sizing: border-box; color: #333333; cursor: text; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 2em; line-height: 1.7; margin: 1em 0px 15px; padding: 0px; position: relative;"><a class="anchor" href="https://github.com/jeremyko/expression-tree-with-user-functions#using-placeholder" name="using-placeholder" style="bottom: 0px; box-sizing: border-box; color: #4183c4; cursor: pointer; display: block; left: 0px; margin-left: -30px; padding-left: 30px; padding-right: 6px; position: absolute; text-decoration: none; top: 0px;"></a>using placeholder</h2><div class="highlight highlight-cpp" style="background-color: white; box-sizing: border-box; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 15px; line-height: 25.5px;"><pre style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(221, 221, 221); box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; line-height: 19px; margin-bottom: 15px; margin-top: 15px; overflow: auto; padding: 6px 10px; word-wrap: normal;"><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">// placeholder identifier is :$ph1, :$ph2, .... :$ph50 (max)</span><br /><span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetInfixExpression</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">":$ph1+:$ph2"</span> <span class="p" style="box-sizing: border-box;">);</span><br /><span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="p" style="box-sizing: border-box;">);</span><br /><span class="k" style="box-sizing: border-box; font-weight: bold;">if</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="p" style="box-sizing: border-box;">)</span><br /><span class="p" style="box-sizing: border-box;">{</span><br />    <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetNumberLongValueOfPlaceHolder</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mi" style="box-sizing: border-box; color: #009999;">1</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetNumberLongValueOfPlaceHolder</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mi" style="box-sizing: border-box; color: #009999;">2</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">pExpressionRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetResult</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">cout</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"expTree.EvaluateExpression returns :"</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultLong</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="se" style="box-sizing: border-box; color: #dd1144;">\n</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="p" style="box-sizing: border-box;">;</span><br />    <span class="n" style="box-sizing: border-box;">EXPECT_EQ</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">3</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultLong</span> <span class="p" style="box-sizing: border-box;">);</span><br /><br />    <span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//-----------------------------------------------------</span><br />    <span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//there's no rebuild tree</span><br />    <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetNumberFloatValueOfPlaceHolder</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mf" style="box-sizing: border-box; color: #009999;">2.0f</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetNumberFloatValueOfPlaceHolder</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mf" style="box-sizing: border-box; color: #009999;">3.0f</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">pExpressionRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetResult</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">cout</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"expTree.EvaluateExpression returns :"</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultFloat</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="se" style="box-sizing: border-box; color: #dd1144;">\n</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="p" style="box-sizing: border-box;">;</span><br />    <span class="n" style="box-sizing: border-box;">EXPECT_FLOAT_EQ</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mf" style="box-sizing: border-box; color: #009999;">5.0f</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">nResultFloat</span> <span class="p" style="box-sizing: border-box;">);</span><br /><br />    <span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">//-----------------------------------------------------</span><br />    <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetStringValueOfPlaceHolder</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"A"</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">SetStringValueOfPlaceHolder</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"B"</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">EvaluateExpression</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">EXPECT_TRUE</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="n" style="box-sizing: border-box;">bRslt</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">pExpressionRslt</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box;">expTree</span><span class="p" style="box-sizing: border-box;">.</span><span class="n" style="box-sizing: border-box;">GetResult</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="p" style="box-sizing: border-box;">);</span><br />    <span class="n" style="box-sizing: border-box;">cout</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"expTree.EvaluateExpression returns :"</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">strResult</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;&lt;</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="se" style="box-sizing: border-box; color: #dd1144;">\n</span><span class="s" style="box-sizing: border-box; color: #dd1144;">"</span><span class="p" style="box-sizing: border-box;">;</span><br />    <span class="n" style="box-sizing: border-box;">EXPECT_STREQ</span> <span class="p" style="box-sizing: border-box;">(</span> <span class="s" style="box-sizing: border-box; color: #dd1144;">"AB"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">pExpressionRslt</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-&gt;</span><span class="n" style="box-sizing: border-box;">strResult</span> <span class="p" style="box-sizing: border-box;">);</span><br /><span class="p" style="box-sizing: border-box;">}</span></pre></div></div>