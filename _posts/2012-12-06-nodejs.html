---
layout: post
title: node.js single thread / multi thread ?
date: '2012-12-06T17:48:00.001+09:00'
author: jeremyko
tags:
- javascript
- node.js
modified_time: '2021-01-03T00:43:15.370+09:00'
thumbnail: https://1.bp.blogspot.com/-YV2uYtFrG9s/UMBdkn_JPMI/AAAAAAAACRw/bTIBm0_OU78/s72-c/node.js_event_loop.png
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-7264007301211701792
blogger_orig_url: https://jeremyko.blogspot.com/2012/12/nodejs.html
---

<b>node.js 는 단일 쓰레드 환경이다.</b><br />그런데 이 말은, 사용자의 스크립트가 단일 쓰레드에서 구동된다는 의미이다.&nbsp;즉, 사용자의 요청들을 처리하기 위한 이벤트 루프가 하나의 쓰레드로 돌아간다.&nbsp;그러나, 실제 비동기 작업은 멀티 쓰레드(thread pool) 로 구현된다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-YV2uYtFrG9s/UMBdkn_JPMI/AAAAAAAACRw/bTIBm0_OU78/s1600/node.js_event_loop.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="185" src="https://1.bp.blogspot.com/-YV2uYtFrG9s/UMBdkn_JPMI/AAAAAAAACRw/bTIBm0_OU78/s320/node.js_event_loop.png" width="320" /></a></div><br />위 그림은 Jeff Kunkel 의 Node.js Explained 유튜브 동영상을 갭쳐한 것이다. 우측으로 node.js 의 쓰레드들이 잘 나타나 있다.&nbsp;node.js는 비동기 작업을 위해 libuv 를 활용하는데&nbsp;여기서 Thread Pool 을 만들어서 작업쓰레드 들이 요청들을 처리하게 된다.<br /><br /><a name='more'></a><br /><br />이 상황을 음식점으로 비유를 해보면 어떨까.<br />중앙에 큰 홀 하나 가 있고 주방이 2개인 식당이 있다고 가정 해보면, node.js에서 일어나는 일은 다음과 같을 것이다.<br /><ol><li><span style="color: #0b5394;">손님들이 몰려와 식당문을 열고 들어온다. 그리고 &nbsp;여기 저기서 주문을 한다.</span></li><li> <span style="color: #0b5394;">종업원이 돌아다니며 부른 순서대로 가서 주문을 한명씩 받고, 주문 즉시&nbsp;주문내역을 재빨리 쪽지에 적어서 주방앞에&nbsp;순서대로 붙여놓는다.</span></li><li><span style="color: #0b5394;">다른 손님들 주문도 이런식으로 처리한다.</span></li><li><span style="color: #0b5394;">모든 주문접수가 끝나면, 종업원은 또다른 손님이 주문을 하거나, &nbsp;요리가 나오기만을 기다린다. 이 종업원은&nbsp;멀티태스킹이 안되는 우직한 사람으로서,&nbsp;오직 서빙(주문/요리 배달)&nbsp;만을 처리한다.</span><span style="color: #0b5394;">&nbsp;</span></li><li><span style="color: #0b5394;">한편, 주방에서는 여러명의 요리사가 대기중이며, 쪽지를 순서대로 가져와서&nbsp;각자 요리를 한다. 그런데 주방이 2개 있으니 만약 한쪽이 붐빈다면, 음식점 사장은 그중에 좀 덜 번잡스러운곳으로 가서 요리를 하라고 요리사들을 안내할것이다.</span></li><li><span style="color: #0b5394;">요리가 먼저 준비되는 순서대로 내놓는다. 그리고 다시 주문서 하나를 가져다가 주방에서 요리를 시작한다.</span></li><li><span style="color: #0b5394;">홀에 있는 종업원은 요리가 나오는것을 지켜보다가 하나씩 가져와서 고객에게 전달한다.&nbsp;</span></li></ol><p style="margin-left: 40px; text-align: left;"><span style="color: #0b5394;">가지러 가는사이 다른 손님이 주문을 하려해도 이미 늦었다. </span><span style="color: #0b5394;">이 종업원은 이전 손님의 요리를 가져와서 먼저 서빙한후에 주문을 받으러 올것이다.</span></p><p><span style="color: #0b5394;">&nbsp;</span><br /></p><div><div>위 예에서 <b>2개의 주방은 2 코어, 우직한 종업원은 이벤트 루프, 쪽지들은 큐, 주방의 요리사들은 작업 멀티 쓰레드라고 볼수 있다. 우리 사장님은 커널의 위치쯤 될거 같다</b>. 사장님이 요리사들을 2개 주방으로 분산시키는것은 바로 스케쥴러에 의해 이루어지는 작업일것이다.<br /><br /></div>이처럼 <b>node.js 가 &nbsp;멀티코어를 전혀 이용 못하는 것은 아니다</b>.&nbsp;OS에 의해 스케쥴링이 이루어지며 서로 다른 core에 배정되어 동작할수 있기 때문이다 . <br /><br /><br /></div>