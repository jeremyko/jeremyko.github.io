---
layout: post
title: Linux Asynchronous I/O 예제
date: '2012-10-26T12:02:00.001+09:00'
author: jeremyko
tags:
- cpp
- linux
- aio
modified_time: '2022-03-26T21:03:13.726+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-6639121789432227087
blogger_orig_url: https://jeremyko.blogspot.com/2012/10/linux-asynchronous-io.html
---

<br /><span style="font-family: Arial, Helvetica, sans-serif;">지금 프로젝트에서 작성한 프로그램의 개선점을 찾다보니, 비동기 작업 처리를 위해 aio를 이용하면 좋을듯 하다. 아래 사이트 내용을 참조하여 완전한 예제로 구성해보았다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><a href="http://www.ibm.com/developerworks/linux/library/l-async/" target="_blank">http://www.ibm.com/developerworks/linux/library/l-async/</a></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"></span><br /><a name='more'></a><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <span style="font-family: Arial, Helvetica, sans-serif;">컴파일은 gcc -lrt -o aioTest aioTest.c 으로 수행.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <span style="font-family: Arial, Helvetica, sans-serif;">file.txt 내용은 다음과 같다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">123456789abcdefghijklmnopqrstuvwxyz</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><br /><table border="0" cellpadding="0" cellspacing="0" style="background-color: #0c1021; color: black; font-family: Arial, Helvetica, sans-serif; text-align: start;"><tbody><tr><td style="vertical-align: top;"><pre class="textmate-source-numbers" style="color: #999999; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; font-size: 9pt; line-height: 1.3em; margin-top: 0em; padding-right: 2em; text-align: right;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br /></pre></td><td style="vertical-align: top;"><pre class="textmate-source" style="color: #f8f8f8; font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; font-size: 9pt; line-height: 1.3em; margin-top: 0em; padding: 0px; word-wrap: break-word;"><pre class="sunburst" style="font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; font-size: 9pt; line-height: 1.3em; margin-top: 0em;"><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//aioTest.c</span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include" style="padding-bottom: 0.1em; padding-top: 0.2em;">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;aio.h&gt;</span></span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include" style="padding-bottom: 0.1em; padding-top: 0.2em;">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;stdio.h&gt;</span></span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include" style="padding-bottom: 0.1em; padding-top: 0.2em;">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;stdlib.h&gt;</span></span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include" style="padding-bottom: 0.1em; padding-top: 0.2em;">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;errno.h&gt;</span></span><br /><span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include" style="padding-bottom: 0.1em; padding-top: 0.2em;">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">&lt;string.h&gt;</span></span><br /><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// gcc -lrt -o aioTest aioTest.c</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// librt" stands for "real time library".</span><br /><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//////////////////////////////////////////////////////////////////</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// busy-wait until the status changes</span><br /><span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">void</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">testBusyWait</span>()</span><br />{<br />    <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span><span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>==================================================<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> fd, ret;<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//int BUFSIZE = 10240;</span><br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> BUFSIZE = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">5</span>;<br />    <span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span> my_aiocb</span>;<br /><br />    fd = open( <span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"file.txt"</span>, O_RDONLY );<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span> (fd &lt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>) <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">perror</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"open"</span>);<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Zero out the aiocb structure (recommended) */</span><br />    bzero( (<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span> *)&amp;my_aiocb, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">sizeof</span>(<span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span></span>) );<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Allocate a data buffer for the aiocb request */</span><br />    my_aiocb.aio_buf = <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">malloc</span>(BUFSIZE+<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>);<br /><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span> (!my_aiocb.aio_buf) <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">perror</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"malloc"</span>);<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Initialize the necessary fields in the aiocb */</span><br />    my_aiocb.aio_fildes = fd;<br />    my_aiocb.aio_nbytes = BUFSIZE;<br />    my_aiocb.aio_offset = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>; <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//the first offset in the file</span><br /><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//below block aio /////////////////////////////////</span><br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> MAX_LIST = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>;<br />    <span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aioct</span> *cblist</span>[MAX_LIST];<br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Clear the list. */</span><br />    bzero( (<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span> *)cblist, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">sizeof</span>(cblist) );<br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Load one or more references into the list */</span><br />    cblist[<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>] = &amp;my_aiocb;<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//below block aio /////////////////////////////////</span><br />    ret = aio_read( &amp;my_aiocb );<br /><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//below block aio /////////////////////////////////</span><br />    ret = aio_suspend( cblist, MAX_LIST, <span class="constant constant_language constant_language_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">NULL</span> );<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//below block aio /////////////////////////////////</span><br /><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span> (ret &lt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>) <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">perror</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aio_read"</span>);<br /><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">while</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> ( aio_error( &amp;my_aiocb )</span> == EINPROGRESS )<br />    {<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"busy waiting...<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    }<br /><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> ((ret = aio_return( &amp;my_aiocb )</span>) &gt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>)<br />    {<br />        <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* got ret bytes on the read */</span><br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"ret [<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%d</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>, ret);<br />        <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//print buffer</span><br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"buff[<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%s</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>,my_aiocb.aio_buf);<br />    }<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">else</span><br />    {<br />        <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* read failed, consult errno */</span><br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"read failed<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    }<br />}<br /><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//////////////////////////////////////////////////////////////////</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// lio_listio , Initiate a list of I/O operations</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// with busy waiting</span><br /><span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">void</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">testListio</span>()</span><br />{<br />    <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span><span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>==================================================<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> fd, ret;<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//int BUFSIZE = 10240;</span><br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> BUFSIZE = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">5</span>;<br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> MAX_LIST = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">2</span>;<br />    <span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span> aiocb1</span>, aiocb2;<br />    <span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span> *list</span>[MAX_LIST];<br /><br />    fd = open( <span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"file.txt"</span>, O_RDONLY );<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span> (fd &lt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>) <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">perror</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"open"</span>);<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Zero out the aiocb structure (recommended) */</span><br />    bzero( (<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span> *)&amp;aiocb1, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">sizeof</span>(<span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span></span>) );<br />    bzero( (<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span> *)&amp;aiocb2, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">sizeof</span>(<span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span></span>) );<br /><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//aiocb1</span><br />    aiocb1.aio_fildes = fd;<br />    aiocb1.aio_buf = <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">malloc</span>(BUFSIZE+<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>);<br />    aiocb1.aio_nbytes = BUFSIZE;<br />    aiocb1.aio_offset = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>; <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//the first offset in the file</span><br />    aiocb1.aio_lio_opcode = LIO_READ;<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//aiocb2</span><br />    aiocb2.aio_fildes = fd;<br />    aiocb2.aio_buf = <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">malloc</span>(BUFSIZE+<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>);<br />    aiocb2.aio_nbytes = BUFSIZE;<br />    aiocb2.aio_offset = BUFSIZE; <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//!!!</span><br />    aiocb2.aio_lio_opcode = LIO_READ;<br /><br />    bzero( (<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span> *)list, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">sizeof</span>(list) );<br />    list[<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>] = &amp;aiocb1;<br />    list[<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>] = &amp;aiocb2;<br /><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//WAIT</span><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//ret = lio_listio( LIO_WAIT, list, MAX_LIST, NULL );</span><br /><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// NO_WAIT</span><br />    ret = lio_listio( LIO_NOWAIT, list, MAX_LIST, <span class="constant constant_language constant_language_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">NULL</span> );<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">while</span> ( aio_error( &amp;aiocb1 ) == EINPROGRESS ||<br />      aio_error( &amp;aiocb2 ) == EINPROGRESS )<br />    {<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"busy waiting...<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    }<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">// NO_WAIT</span><br /><br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//aiocb1</span><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> ((ret = aio_return( &amp;aiocb1 )</span>) &gt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>)<br />    {<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>******<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aiocb1 ret [<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%d</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>, ret);<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aiocb1 buff[<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%s</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>,aiocb1.aio_buf);<br />    }<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">else</span><br />    {<br />        <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* read failed, consult errno */</span><br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aiocb1 read failed<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    }<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//aiocb2</span><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> ((ret = aio_return( &amp;aiocb2 )</span>) &gt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>)<br />    {<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>******<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aiocb2 ret [<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%d</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>, ret);<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aiocb2 buff[<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%s</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>,aiocb2.aio_buf);<br />    }<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">else</span><br />    {<br />        <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* read failed, consult errno */</span><br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aiocb2 read failed<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    }<br />}<br /><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//////////////////////////////////////////////////////////////////</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//aio with callback</span><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//also available : Asynchronous notification with signals</span><br /><br /><span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span> my_aiocb</span>; <br /><br /><span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">void</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aio_completion_handler</span>( sigval_t sigval )</span><br />{<br />    <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"aio_completion_handler<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    <span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span> *req</span>;<br /><br />    req = (<span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span> *</span>)sigval.sival_ptr;<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Did the request complete? */</span><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> (aio_error( req )</span> == <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>) {<br /><br />        <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Request completed successfully, get the return status */</span><br />        <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> ret = aio_return( req );<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"ret [<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%d</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>, ret);<br />        <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"buff[<span class="constant constant_other constant_other_placeholder constant_other_placeholder_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">%s</span>]<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>,req-&gt;aio_buf);<br />    }<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">return</span>;<br />}<br /><br /><br /><span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">void</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">testCallback</span>()</span><br />{<br />    <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">printf</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span><span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>==================================================<span class="constant constant_character constant_character_escape constant_character_escape_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">\n</span>"</span>);<br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> fd, ret;<br />    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//int BUFSIZE = 10240;</span><br />    <span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> BUFSIZE = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">20</span>;<br /><br />    fd = open( <span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"file.txt"</span>, O_RDONLY );<br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">if</span> (fd &lt; <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>) <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">perror</span>(<span class="string string_quoted string_quoted_double string_quoted_double_c" style="color: #61ce3c; padding-bottom: 0.1em; padding-top: 0.2em;">"open"</span>);<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Set up the AIO request */</span><br />    bzero( (<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span> *)&amp;my_aiocb, <span class="keyword keyword_operator keyword_operator_sizeof keyword_operator_sizeof_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">sizeof</span>(<span class="meta meta_class-struct-block meta_class-struct-block_c++" style="padding-bottom: 0.1em; padding-top: 0.2em;"><span class="storage storage_type storage_type_c++" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">aiocb</span></span>) );<br />    my_aiocb.aio_fildes = fd;<br />    my_aiocb.aio_buf = <span class="support support_function support_function_C99 support_function_C99_c" style="color: #8da6ce; padding-bottom: 0.1em; padding-top: 0.2em;">malloc</span>(BUFSIZE+<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>);<br />    my_aiocb.aio_nbytes = BUFSIZE;<br />    my_aiocb.aio_offset = <span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">0</span>;<br /><br />    <span class="comment comment_block comment_block_c" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">/* Link the AIO request with a thread callback */</span><br />    my_aiocb.aio_sigevent.sigev_notify = SIGEV_THREAD;<br />    my_aiocb.aio_sigevent.sigev_notify_function = aio_completion_handler;<br />    my_aiocb.aio_sigevent.sigev_notify_attributes = <span class="constant constant_language constant_language_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">NULL</span>;<br />    my_aiocb.aio_sigevent.sigev_value.sival_ptr = &amp;my_aiocb;<br /><br />    ret = aio_read( &amp;my_aiocb );<br />}<br /><br /><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++" style="color: #aeaeae; padding-bottom: 0.1em; padding-top: 0.2em;">//////////////////////////////////////////////////////////////////</span><br /><span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span><span class="meta meta_function meta_function_c" style="padding-bottom: 0.1em; padding-top: 0.2em;"> <span class="entity entity_name entity_name_function entity_name_function_c" style="color: #ff6400; padding-bottom: 0.1em; padding-top: 0.2em;">main</span>(<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">int</span> argc,<span class="storage storage_type storage_type_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">char</span>** argv)</span><br />{<br />    testBusyWait();<br />    testListio();<br />    testCallback();<br /><br />    <span class="keyword keyword_control keyword_control_c" style="color: #fbde2d; padding-bottom: 0.1em; padding-top: 0.2em;">while</span>(<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>)<br />    {<br />        sleep(<span class="constant constant_numeric constant_numeric_c" style="color: #d8fa3c; padding-bottom: 0.1em; padding-top: 0.2em;">1</span>);<br />    }<br />}<br /></pre></pre></td></tr></tbody></table><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>  <span style="font-family: Arial, Helvetica, sans-serif;">수행 결과는 다음과 같다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">==============================================================</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">ret [5]</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">buff[12345]</span><br /><span style="color: #134f5c;"><br /></span> <span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">==============================================================</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb1 busy waiting...</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb1 busy waiting...</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">.....</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb1 busy waiting...</span><br /><span style="color: #134f5c;"><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <span style="font-family: Arial, Helvetica, sans-serif;">******</span></span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb1 ret [5]</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb1 buff[12345]</span><br /><span style="color: #134f5c;"><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span> <span style="font-family: Arial, Helvetica, sans-serif;">******</span></span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb2 ret [5]</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aiocb2 buff[6789a]</span><br /><span style="color: #134f5c;"><br /></span> <span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">==============================================================</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">aio_completion_handler</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">ret [20]</span><br /><span style="color: #134f5c; font-family: Arial, Helvetica, sans-serif;">buff[123456789abcdefghijk]</span><br /><div><br /></div>