---
layout: post
title: 'node.js : threads-a-gogo compile error'
date: '2012-12-11T01:09:00.000+09:00'
author: jeremyko
tags:
- node.js
modified_time: '2012-12-11T01:11:17.051+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-6492509203588761622
blogger_orig_url: https://jeremyko.blogspot.com/2012/12/nodejs-threads-gogo-compile-error.html
---

<br /><span style="font-family: Arial, Helvetica, sans-serif;">node.js를 위한 thread,&nbsp;<span style="color: #333333; line-height: 19px;"><a href="https://github.com/xk/node-threads-a-gogo" target="_blank">threads_a_gogo</a> 컴파일시 오류 해결 방법</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #333333; line-height: 19px;"></span></span><br /><a name='more'></a><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #333333; line-height: 19px;"><br /></span></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">koui-MacBook-Pro:node-threads-a-gogo kojunghyun$ node-waf configure install</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">******** THREADS_A_GOGO ********</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">**** Executing the configuration</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program gcc or cc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : /usr/bin/gcc&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program cpp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : /usr/bin/cpp&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program ar &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: /usr/bin/ar&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program ranlib &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: /usr/bin/ranlib&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program g++ or c++ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: /usr/bin/g++&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program ar &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: /usr/bin/ar&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for program ranlib &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: /usr/bin/ranlib&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for g++ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : ok &nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">**** Checking for node_addon</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for node path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : not found&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Checking for node prefix &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : ok /usr/local&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">**** Compiling minify.c</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">gcc /Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/deps/minifier/src/minify.c -o /Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/deps/minifier/bin/minify</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">'configure' finished successfully (0.210s)</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Waf: Entering directory `/Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/build'</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">*** Building the project</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">**** Minifying .js source files</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">cat /Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/src/createPool.js | /Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/deps/minifier/bin/minify kCreatePool_js &gt; /Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/src/createPool.js.c</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">......</span><br /> <span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">[1/2] cxx: src/threads_a_gogo.cc -&gt; build/Release/src/threads_a_gogo_1.o</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc: In function ‘void* aThread(void*)’:</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc:202: <span style="background-color: #fff2cc;"><b>error: cannot convert ‘ev_async*’ to ‘ev_loop*’ for argument ‘1’ to ‘void ev_async_send(ev_loop*, ev_async*)’</b></span></span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc: In function ‘void eventLoop(typeThread*)’:</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc:281: <span style="background-color: #fff2cc;"><b>error: cannot convert ‘ev_async*’ to ‘ev_loop*’ for argument ‘1’ to ‘void ev_async_send(ev_loop*, ev_async*)’</b></span></span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc: In function ‘void destroyaThread(typeThread*)’:</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc:362: <span style="background-color: #fff2cc;"><b>error: cannot convert ‘ev_async*’ to ‘ev_loop*’ for argument ‘1’ to ‘void ev_async_stop(ev_loop*, ev_async*)’</b></span></span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc: In function ‘void Callback(ev_async*, int)’:</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc:423: <span style="background-color: #fff2cc;"><b>error: cannot convert ‘ev_async*’ to ‘ev_loop*’ for argument ‘1’ to ‘void ev_async_send(ev_loop*, ev_async*)’</b></span></span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc: In function ‘v8::Handle&lt;v8::Value&gt; threadEmit(const v8::Arguments&amp;)’:</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc:646: <span style="background-color: #fff2cc;"><b>error: cannot convert ‘ev_async*’ to ‘ev_loop*’ for argument ‘1’ to ‘void ev_async_send(ev_loop*, ev_async*)’</b></span></span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc: In function ‘v8::Handle&lt;v8::Value&gt; Create(const v8::Arguments&amp;)’:</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">../src/threads_a_gogo.cc:685: <span style="background-color: #fff2cc;"><b>error: invalid conversion from ‘void (*)(ev_async*, int)’ to ‘void (*)(ev_loop*, ev_async*, int)’</b></span></span><br /><span style="background-color: #fff2cc; color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><b>../src/threads_a_gogo.cc:686: error: cannot convert ‘ev_async*’ to ‘ev_loop*’ for argument ‘1’ to ‘void ev_async_start(ev_loop*, ev_async*)’</b></span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Waf: Leaving directory `/Users/kojunghyun/kojh/MyDev_MBP/NodeJs_Dev/node-threads-a-gogo/build'</span><br /><span style="color: #990000; font-family: Arial, Helvetica, sans-serif; font-size: x-small;">Build failed: &nbsp;-&gt; task failed (err #1):&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; {task: cxx threads_a_gogo.cc -&gt; threads_a_gogo_1.o}</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;">koui-MacBook-Pro:node-threads-a-gogo kojunghyun$&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;"><b style="background-color: #ffe599;">해결 : threads_a_gogo.cc 파일 제일 위쪽 부분에 다음을 선언한다.</b></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="color: #0b5394; font-family: Arial, Helvetica, sans-serif;">#define NODE_WANT_INTERNALS 0</span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;"><b style="background-color: #ffe599;">Why?</b></span><br /><br /><span style="font-family: Arial, Helvetica, sans-serif;"></span> <span style="font-family: Arial, Helvetica, sans-serif;">ev 소스는 잘 모르지만 왜 컴파일 오류가 나는지만 알아보자.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">먼저 오류가 나는 함수의 정의는 다음과 같다.</span><br /><br /> <span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">void</span></span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">ev_async_send (EV_P_ ev_async *w)</span></span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">{</span></span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">&nbsp; &nbsp; w-&gt;sent = 1;</span></span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">&nbsp; &nbsp; evpipe_write (EV_A_ &amp;async_pending);</span></span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">}</span></span></span><br /><br /> <span style="font-family: Arial, Helvetica, sans-serif;">그리고 다음처럼 정의되어 있다.</span><br /><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394; font-family: Arial, Helvetica, sans-serif;"># define EV_P &nbsp;struct ev_loop *loop</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394; font-family: Arial, Helvetica, sans-serif;"># define EV_P_ EV_P, &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394; font-family: Arial, Helvetica, sans-serif;"><br /></span></span><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;">즉, 위의 함수는<span style="color: #0b5394;">&nbsp;</span></span><span style="color: #0b5394;">ev_async_send (</span><span style="color: #0b5394;">struct ev_loop *loop,</span><span style="color: #0b5394;">&nbsp;ev_async *w) </span>원형을 가진다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-family: Arial, Helvetica, sans-serif;">그런데,&nbsp;</span>node.h 의 하단부에 다음과 같은 전처리문이 존재한다.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>  <span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">#if !defined(NODE_WANT_INTERNALS) &amp;&amp; !defined(_WIN32)</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;"># include "ev-emul.h"</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;"># include "eio-emul.h"</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">#endif</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;"><br /></span></span><span style="font-family: Arial, Helvetica, sans-serif;">NODE_WANT_INTERNALS 가 정의 안되있는 경우,&nbsp;ev-emul.h,&nbsp;eio-emul.h 헤더를 포함하게 되고,&nbsp;ev-emul.h 에서는 기존 정의를 무시하게 만들고 있다 (뭔지?).&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;"><br /></span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">#undef EV_P</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">#undef EV_P_</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">...</span></span><br /> <span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">#define EV_P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;void</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">#define EV_P_</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #0b5394;">NODE_WANT_INTERNALS </span>이게 어떤 용도인지 궁금... 아무튼 컴파일은 성공~</span>