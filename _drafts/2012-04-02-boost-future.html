---
layout: post
title: boost future
date: '2012-04-02T15:50:00.002+09:00'
author: jeremyko
tags:
- cpp
- boost
modified_time: '2016-12-31T15:20:36.736+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-7224816074922991421
blogger_orig_url: https://jeremyko.blogspot.com/2012/04/boost-future.html
---

<br /><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">다음글은&nbsp;<a href="http://www.boost.org/doc/libs/1_49_0/doc/html/thread/synchronization.html#thread.synchronization.futures" style="color: #909090; text-decoration: none;" target="_blank">boost 홈페이지의 글</a>을 참고로 작성되었습니다</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="color: #006699; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif; font-size: small;"><b>boost future</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">어떤 처리를 통해서 앞으로 얻게될 값이 있다고 생각해보자.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이값은 획득하기까지 시간이 필요해서, 동기적으로 바로 얻을수 없을수도 있다.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">그리고 이값은 다른쓰레드에 의해 생성이 될수도 있고, 현재 쓰레드에서 외부 요청에&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">의해 생성이 될수도 있다. future는 이러한 값들을 동기적으로 처리하기 위한 목적이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">동기적이란, 어떤 동작의 비동기적 완료를 위한 대기, 체크등을 위한 별도 코딩 없이,&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">함수의 리턴값을 받는식의 동기적인 코딩이 가능하다는 의미이다.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이를 위한 4가지 템플릿 클래스가 있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"></span><br /><a name='more'></a><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><span style="color: #006699;">boost::unique_future, boost::shared_future</span>&nbsp;=&gt; &nbsp;비동기적인 결과를 얻는다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><span style="color: #006699;">boost::promise, boost::packaged_task</span>&nbsp;=&gt; 비동기적인 결과를 발생시킨다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::unique_future 는 소유권이 오직 하나의 인스턴스에게 있다. 소유권은 인스턴스간&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이전가능하지만, 하나의 인스턴스만이 결과에 대한 참조를 가진다.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">결과가 준비되면 &nbsp;boost::unique_future&lt;R&gt;::get() 를 통해서 얻을수 있다&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">(rvalue-reference &nbsp;방식으로, 즉 1번만 <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">get <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">호출가능</span></span>).</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">반면 boost::shared_future 는 소유권이 공유된다. 여러개의 인스턴스가 동일한 경과를&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">참조할수 있고 인스턴스는 자유롭게 복사, 할당이 가능하다.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::shared_future&lt;R&gt;::get()는 const reference를 리턴하기 때문에 여러번 get()을 호출해도 안전하다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::unique_future 인스턴스를 boost::shared_future 인스턴스로 옮길수 있다.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이때 소유권이 이전이 된다 (반대의 경우는 소유권 이전 일어나지 않는다).</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::wait()을 이용해서 각각의 future를 기다리거나,&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::wait_for_any(), boost::wait_for_all() 함수를 이용해서 그중의 하나의 future를&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">기다릴수 있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::promise 나 boost::packaged_task 를 이용해서 future에 값을 설정한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::packaged_task 는 함수나 callable object을 감싸는 callable object이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이것이 호출되면 가지고 있던 함수를 호출하고, 그 리턴값과 함께 future를 완료시킨다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이것은 오랫동안 논의되어진 문제 -&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">쓰레드에서 어떻게 값을 리턴하는가?- 에 대한 해답이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">실행할 함수를 boost::packaged_task로 만들고, 쓰레드 생성자에 넘긴다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">그럼 boost::packaged_task로 부터 얻어진 future 인스턴스는 리턴값을 얻기 위해 사용가능하다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">만약 함수가 예외를 던진다면 이값이 future에 저장되고 리턴값이 될것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">int calculate_the_answer_to_life_the_universe_and_everything()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; return 42;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::packaged_task&lt;int&gt; pt(calculate_the_answer_to_life_the_universe_and_everything);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::unique_future&lt;int&gt; fi=pt.get_future();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::thread task(boost::move(pt)); // launch task on a thread</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; fi.wait(); // wait for it to finish</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; assert(fi.is_ready());</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; assert(fi.has_value());</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; assert(!fi.has_exception());</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; assert(fi.get_state()==boost::future_state::ready);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; assert(fi.get()==42);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::promise 는 좀더 저수준 목적으로, 연관된 future의 값 혹은 예외를 저장하기 위한&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">기능을 제공한다. 값이 하나가 아닌 여러곳에서 오는 경우나 하나의 동작이 여러개의 값을&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">만드는 경우에 사용한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::promise&lt;int&gt; pi;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">void threadFunc1()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::lock_guard&lt;boost::mutex&gt; lock(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; try</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; {</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; pi.set_value(10); //값이 여러곳에서 설정되는 경우를 억지로 :-( 가정</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; }</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; catch(boost::promise_already_satisfied&amp;)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; {</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; std::cout&lt;&lt;"threadFunc1: promise_already_satisfied"&lt;&lt;std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; }</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">void threadFunc2()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::lock_guard&lt;boost::mutex&gt; lock(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; try</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; {</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; pi.set_value(100); //값이 여러곳에서 설정되는 경우를 억지로:-/ 가정</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; }</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; catch(boost::promise_already_satisfied&amp;)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; {</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; std::cout&lt;&lt;"threadFunc2: promise_already_satisfied"&lt;&lt;std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; }</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::shared_future&lt;int&gt; fi;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; fi=pi.get_future();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::thread task1(threadFunc1);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::thread task2(threadFunc2);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; task1.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; task2.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; std::cout&lt;&lt;"fi.get():"&lt;&lt;fi.get()&lt;&lt;std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="color: #006699; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif; font-size: x-small;"><b>Wait Callbacks and Lazy Futures</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">boost::promise과 boost::packaged_task 는 wait callbacks을 지원.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">지금까지의 예제는 작업이 일단 먼저 수행되고 결과를 나중에 받는 방식이었다.&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">반면, 결과값이 당장 계산되어질 필요없이, 필요한 경우에만 구해지도록 하는&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">lazy future도 가능하다.&nbsp;</span><span style="background-color: white; color: #006699; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">set_wait_callback()&nbsp;</span><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">멤버함수를 사용한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">#include &lt;iostream&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">#include &lt;boost/thread.hpp&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">int calculate_the_answer_to_life_the_universe_and_everything()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; std::cout&lt;&lt;"calculate_the_answer_to_life_the_universe_and_everything invoked"&lt;&lt;std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::this_thread::sleep(boost::posix_time::seconds(5)); //some work...</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; return 42;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">void invoke_lazy_task(boost::packaged_task&lt;int&gt;&amp; task)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; try</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; {</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; std::cout&lt;&lt;"invoke_lazy_task invoked-&gt; call task()"&lt;&lt;std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; task();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; }</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; catch(boost::task_already_started&amp;)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; {}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::packaged_task&lt;int&gt; task(calculate_the_answer_to_life_the_universe_and_everything);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; task.set_wait_callback(invoke_lazy_task); //즉시 리턴됨</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; boost::unique_future&lt;int&gt; f(task.get_future());//즉시 리턴됨</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">&nbsp; &nbsp; assert(42==f.get()); //이때 지정된 콜백이 호출됨... 이호출이 없으면 task가 동작안함.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">}</span></div><br class="Apple-interchange-newline" />