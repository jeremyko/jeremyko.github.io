---
layout: post
title: boost - thread (2/3) Synchronization
date: '2012-03-27T17:53:00.000+09:00'
author: jeremyko
tags:
- cpp
- boost
modified_time: '2016-12-31T15:20:36.714+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-1324129711966939850
blogger_orig_url: https://jeremyko.blogspot.com/2012/03/boost-thread-23-synchronization.html
---

<div style="text-align: left;"><span style="background-color: white; color: #555555; font-family: Arial, helvetica, sans-serif; font-size: 12px; line-height: 18px;">Copyright © 2008-2010 Boris Schäling</span><br /><span style="background-color: white; color: #999999; font-family: Arial, helvetica, sans-serif; font-size: 12px; line-height: 18px;">이글은 다음 사이트 내용을 참조로 작성되었고. 개인적인 Study 목적으로 작성되었습니다.</span></div><div style="background-color: white; text-align: left;"><div style="text-align: -webkit-auto;"><span style="background-color: white; color: #999999; font-family: Arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;">The contents of this page are constructed with reference to the following site and&nbsp;</span><span style="background-color: white; color: #999999; font-family: Arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;">translated just for personal academic study only</span><span style="background-color: white; color: #999999; font-family: Arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;">. &nbsp;</span><br /><div style="text-align: left;"><span style="font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px;"><span style="background-color: white; color: #999999; font-family: Arial, helvetica, sans-serif; text-decoration: none;"><a href="http://en.highscore.de/cpp/boost/" style="text-decoration: none;" target="_blank">http://en.highscore.de/cpp/boost/</a>&nbsp;</span></span><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: xx-small;"><a href="http://www.boost.org/doc/libs/1_41_0/doc/html/thread/synchronization.html">http://www.boost.org/doc/libs/1_41_0/doc/html/thread/synchronization.html</a> <br /><a href="http://drdobbs.com/article/print?articleId=211600441&amp;siteSectionName=cpp">http://drdobbs.com/article/print?articleId=211600441&amp;siteSectionName=cpp</a></span><br /><div style="font-size: 12px; line-height: 18px;"><b style="font-family: arial, helvetica, sans-serif;"><br /></b></div></div></div></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">동기화를 위해서 여러 종류의 mutex가 제공된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><a name='more'></a><span style="font-family: Arial, helvetica, sans-serif;"><br /></span><b><span style="font-family: Arial, helvetica, sans-serif;"><span style="color: #006699; font-size: small;">boost::mutex</span>&nbsp;</span>&nbsp;</b></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;boost/thread.hpp&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;iostream&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void wait(int seconds)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; boost::this_thread::sleep(boost::posix_time::seconds(seconds));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void thread()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 5; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp;{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wait(1);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mutex.lock();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;std::cout &lt;&lt; "Thread " &lt;&lt; boost::this_thread::get_id() &lt;&lt; ": " &lt;&lt; i &lt;&lt; std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mutex.unlock();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp;}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; boost::thread t1(thread);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; boost::thread t2(thread);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; t1.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; t2.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">lock, unlock을 직접 호출하는것 대신&nbsp;<b><span style="color: #006699; font-size: small;">boost::lock_guard</span></b>&nbsp; 클래스를 이용할수 있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;boost/thread.hpp&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;iostream&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void wait(int seconds)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::this_thread::sleep(boost::posix_time::seconds(seconds));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void thread()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 5; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; wait(1);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; boost::lock_guard&lt;boost::mutex&gt; lock(mutex); // 즉, scoped lock</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; std::cout &lt;&lt; "Thread " &lt;&lt; boost::this_thread::get_id() &lt;&lt; ": " &lt;&lt; i &lt;&lt; std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t1(thread);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t2(thread);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t1.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t2.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그밖에 다양한 동기화를 위한 클래스를 제공한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그중에&nbsp;<span style="color: #006699; font-size: small;"><b>boost::unique_lock</b></span>&nbsp;이 있는데, boost::lock_guard과 비교해서,&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">다수의 유용한 메서드를 제공한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;boost/thread.hpp&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;iostream&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void wait(int seconds)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::this_thread::sleep(boost::posix_time::seconds(seconds));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::timed_mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void thread()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 5; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>wait(1);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::unique_lock&lt;boost::timed_mutex&gt; lock(mutex, boost::try_to_lock);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>if (!lock.owns_lock())</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;">  </span>lock.timed_lock(boost::get_system_time() + boost::posix_time::seconds(1));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>std::cout &lt;&lt; "Thread " &lt;&lt; boost::this_thread::get_id() &lt;&lt; ": " &lt;&lt; i &lt;&lt; std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::timed_mutex *m = lock.release();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>m-&gt;unlock();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t1(thread);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t2(thread);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t1.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t2.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">위의 예제는 boost::unique_lock의 다양한 기능을 알아보기 위한 목적이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">(이 상황에서라면 boost::lock_guard 구현된 예제가 더 적절하다)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::unique_lock은 여러 종류의 mutex를 얻기 위한 복수개의 생성자를 제공한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">오직 mutex객체를 얻으려면, lock() 을 호출하고 뮤텍스가 획득되기를 기다리면 된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span>boost::mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><span class="Apple-tab-span" style="white-space: pre;"> </span>boost::unique_lock&lt;boost::mutex&gt; lock(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이 경우는 boost::lock_guard과 똑같은 방식으로 작동한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">만약, 두번째 인자로 boost::try_to_lock 가 전달된 경우에는,&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">해당 생성자는 try_lock()을 호출한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이메서드는 뮤텍스 획득이 가능하면 bool: true 형을 리턴하고, 그렇지 않다면</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">bool: false를 리턴하는데, lock()과는 달리 블럭되지 않고 즉시 리턴된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">뮤텍스를 획득했는지 여부는 owns_lock() 메서드 호출로 알수있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">실패시 false를 리턴되는데, 예제에서는 이때 boost::unique_lock가 제공하는 또다른</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">기능인 timed_lock() 를 호출해서 뮤텍스 획득을 일정시간 기다리게 한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">예제에서는 3가지 기본적인 뮤텍스획득 방식을 보여준다.&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">lock()은 뮤텍스를 얻기까지 블럭된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">try_lock()은 뮤텍스 획득 시도후 결과를 즉시 리턴한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">timed_lock()은 주어진 시간동안 뮤텍스 획득을 위해 시도한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::mutex 에 대해 lock(), try_lock()이 제공되어지는것과 달리 timed_lock()은</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span style="color: #006699; font-size: small;">boost::timed_mutex</span></b>&nbsp;에 대해서만 가능하다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">예제에서 만약 timed_lock()을 사용하지 않느다면, 뮤텍스 타입은 boost::mutex도</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">사용 가능하다 (굳이 boost::timed_mutex 일 필요없음).</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::lock_guard과 마찬가지로 boost::unique_lock도 소멸자에서 뮤텍스를 해제한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그리고 unlock()메서드를 이용해서 수동으로 뮤텍스 해제도 가능하다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">또한 위예제처럼 release() 를 호출해서, boost::unique_lock 과 뮤텍스의 연관을 해제시킬수 있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이경우에는 unlock()을 이용해서 뮤텍스를 명시적으로 해제시키는것이 필요하다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::unique_lock 소멸자에서 자동적으로 해제되지 않기 때문이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::unique_lock은 일반적으로 말하는 exclusive lock 이다. 오직 하나의 스레드만이</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">뮤텍스를 획득하며, 다른 스레드는 뮤텍스 해제를 기다린다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">한편 non-exclusive lock도 존재하는데 boost가 제공하는것은&nbsp;<b><span style="color: #006699; font-size: small;">boost::shared_lock</span></b>&nbsp;이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이 클래스는 반드시&nbsp;<b><span style="color: #006699; font-size: small;">boost::shared_mutex</span></b>&nbsp;타입의 뮤텍스와 같이 사용된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">//multiple reader, single writer예제이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;boost/thread.hpp&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;iostream&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;vector&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;cstdlib&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;ctime&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void wait(int seconds)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::this_thread::sleep(boost::posix_time::seconds(seconds));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::shared_mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">std::vector&lt;int&gt; random_numbers;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void fill()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>std::srand(static_cast&lt;unsigned int&gt;(std::time(0)));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 3; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; boost::unique_lock&lt;boost::shared_mutex&gt; lock(mutex); //exclusive lock</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; random_numbers.push_back(std::rand());</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; lock.unlock();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; wait(1); // 이것은 fill()-print()-count()순서대로 처리하고자 의도된 것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void print()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 3; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; wait(1); //!!</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; boost::shared_lock&lt;boost::shared_mutex&gt; lock(mutex); //non-exclusive lock</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp; &nbsp; std::cout &lt;&lt; random_numbers.back() &lt;&lt; std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">int sum = 0;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void count()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 3; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>wait(1);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::shared_lock&lt;boost::shared_mutex&gt; lock(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>sum += random_numbers.back();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t1(fill);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t2(print);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t3(count);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t1.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t2.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t3.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>std::cout &lt;&lt; "Summe: " &lt;&lt; sum &lt;&lt; std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">Readers–writer lock 이다. 공유자원을 변경시에는 배타적인 lock이 사용되었고</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">데이터를 읽기만 하는경우에 boost::shared_lock 이 사용되었다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">예제에서 wait()함수가 호출된 지점을 보면 각 쓰레드 함수가 동일하지 않다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">fill()함수에서는 루프 마지막에 사용되었고 다른 함수에서는 루프 처음에 사용되었다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이것은 쓰레드 동작시 fill()-&gt;print()-&gt;count() 순서대로 처리하고자 의도된 것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">하지만, 각 쓰레드함수의 동작 순서는 CPU가 각각의 쓰레드를 실행하는 순서와</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">직접적으로 연관이 있기 때문에, 예제에서의 방식처럼 wait()위치를 조정하여</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">쓰레드 함수의 동작순서를 조정하는것은 잠재적인 문제를 갖고있다.</span></div><div style="background-color: white; color: #555555; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; line-height: 18px; text-align: left;"><div style="color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px;"></div></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="color: #006699; font-family: Arial, helvetica, sans-serif; font-size: small;"><b>boost::condition_variable_any</b></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><b style="color: #006699; font-family: Arial, helvetica, sans-serif; font-size: medium;">boost::condition_variable</b></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이때 조건변수(condition variables)를 이용하면, 쓰레드들간 통보가 가능하므로</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">앞서의 실행 순서 문제도 조절가능하다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;boost/thread.hpp&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;iostream&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;vector&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;cstdlib&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">#include &lt;ctime&gt;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::mutex mutex;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::condition_variable_any cond;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">std::vector&lt;int&gt; random_numbers;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void fill()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>std::srand(static_cast&lt;unsigned int&gt;(std::time(0)));</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 3; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::unique_lock&lt;boost::mutex&gt; lock(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>random_numbers.push_back(std::rand());</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>cond.notify_all();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>cond.wait(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">void print()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>std::size_t next_size = 1;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>for (int i = 0; i &lt; 3; ++i)</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::unique_lock&lt;boost::mutex&gt; lock(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>while (random_numbers.size() != next_size) //이것은 wait호출 필요가 없는 경우를 판단.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;">  </span>cond.wait(mutex);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>std::cout &lt;&lt; random_numbers.back() &lt;&lt; std::endl;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>++next_size;</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>cond.notify_all();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">int main()</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t1(fill);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>boost::thread t2(print);</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t1.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp;&nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span>t2.join();</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">}</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이제 wait() 과 count() 함수는 없어졌고, 쓰레드에서는 매 루프마다 1초씩 기다리지 않고&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">최대한 빠르게 처리한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">조건변수는 쓰레드간에 특정 조건을 체크할수 있게 해준다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">앞서 예제와 동일하게 fill()함수내에서는 exclusive lock을&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">사용하여 다른 쓰레드로부터 접근을 막는다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">대신 1초 대기하지 않고 conditional variable를 사용한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">notify_all() 함수는 wait() 를 호출하고 대기중인 모든 쓰레드를 깨어나게 한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">print()함수에서는 wait()이 호출되고있는데, notify_all()로 깨어나면 뮤텍스 획득을 시도하며,</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">fill()함수에서 성공적으로 뮤텍스가 해제된 경우에만 성공한다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">중요한점은 wait() 호출은 또한 전달된 뮤텍스를 해제 시킨다는 것이다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">fill()에서 notify_all()호출 후 wait()를 호출함으로서 뮤텍스를 해제시키고 있다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">그럼 print() 쓰레드가 notify_all()을 호출할때까지 블럭되어 대기하게 된다.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><br /></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">boost::condition_variable 은 boost::unique_lock&lt;boost::mutex&gt; 가능.</span></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;">이를 보완하기위해서 추가된것이&nbsp;</span><span style="font-family: Arial, helvetica, sans-serif;">boost::condition_variable_any 이다.</span></div><div style="background-color: white; color: #555555; font-size: 12px; line-height: 18px; text-align: left;"><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">boost::condition_variable_any 는 모든 mutex 타입에 대해서 사용 가능하다.</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="font-family: arial, helvetica, sans-serif;"><br /></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"><b><span style="color: #006699; font-size: small;">boost::lock() , boost::try_lock()</span></b></span><br /><span style="background-color: white; font-family: Arial, helvetica, sans-serif;">데드락을 방지하기 위한 목적.</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">기존의 전형적인 데드락 발생 예제를 보면, 두개의 뮤텍스를 서로 다른 순서로 잠그려고 하는 것이다.</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">만약 락이 동시에 잠기고 풀린다면 데드락은 방지될수 있다.</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">비멤버함수인 lock()과 try_lock()은 동일한 잠금에 대해서 여러 쓰레드에서</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">동시에(그리고 정해진 순서없이) 호출되도, 데드락에 안전하다.</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">생성자를 통해서 5개까지 잠금을 지정할수있다.</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div><span style="font-family: Arial, helvetica, sans-serif;">template&lt;typename Lockable1,typename Lockable2&gt;</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div><span style="font-family: Arial, helvetica, sans-serif;">void lock(Lockable1&amp; l1,Lockable2&amp; l2);</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><div><span style="font-family: Arial, helvetica, sans-serif;">...</span></div><span style="font-family: Arial, helvetica, sans-serif;"><div>template&lt;typename Lockable1,typename Lockable2,typename Lockable3,typename Lockable4,typename Lockable5&gt;</div><div>void lock(Lockable1&amp; l1,Lockable2&amp; l2,Lockable3&amp; l3,Lockable4&amp; l4,Lockable5&amp; l5);</div><div><br /></div><div>lock()은 여러개의 lock중에서 하나라도 잠금에 실패하는것이 있다면 예외를 발생시키고</div><div>함수종료전에 그동안 잠궜던 락을 모두 해제한다.</div><div>try_lock()은 여러개의 lock중에서 하나라도 잠금에 실패하는것이 있다면 그동안 잠궜던</div><div>락을 모두 해제하고, lock에 실패한 것의 인덱스를 리턴한다.<br /><br /></div></span><br /><div style="font-family: arial, helvetica, sans-serif;"></div><div style="font-family: arial, helvetica, sans-serif;"><b><span style="color: #006699; font-size: small;"><span style="font-family: Arial, helvetica, sans-serif;">boost::barrier</span>&nbsp;</span></b></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">생성자에 전달된 쓰레드 갯수만큼 wait()멤버 함수가 호출되기를 기다려준다. 즉,</span></div><div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">boost::mutex mutex;</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">void thread_func (int id, boost::barrier* bar)</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">{</span><br /><span style="background-color: white; font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; {</span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;"></span></div><div style="font-family: arial, helvetica, sans-serif;"><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; boost::mutex::scoped_lock &nbsp;lock(mutex);</span><br /><span style="background-color: white; font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; std::cout &lt;&lt; "thread_func:"&lt;&lt; id &lt;&lt; std::endl;</span><br /><span style="background-color: white; font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; }</span><br /><span style="background-color: white;">&nbsp; &nbsp; bar-&gt;wait(); // 여기서 다른 쓰레드의wait() 호출을 대기함...</span><br /><span style="background-color: white;">}</span><br /><span style="background-color: white;"><br /></span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div><span style="font-family: Arial, helvetica, sans-serif;">int main()</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div><span style="font-family: Arial, helvetica, sans-serif;">{</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><br /><div><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; boost::barrier barrier(2);</span></div><span style="font-family: Arial, helvetica, sans-serif;"></span><div><span style="font-family: Arial, helvetica, sans-serif;">&nbsp; &nbsp; boost::thread t1(thread_func,1, &amp;barrier);</span></div><span style="font-family: Arial, helvetica, sans-serif;"><div>&nbsp; &nbsp; boost::thread t2(thread_func,2, &amp;barrier);</div><div>&nbsp; &nbsp; t1.join(); &nbsp; &nbsp;</div><div>&nbsp; &nbsp; //t2에 대해서는 join()호출이 없다!</div><div><br /></div><div>&nbsp; &nbsp; return 0;</div><div>}</div><div><br /></div><div>barrier 생성시에 갯수를 2로 지정했고, 이것은 wait()함수가 2번 호출될때까지<br />블럭킹되서 대기하겠다는 의미이다.</div><div>t1에 대해서만 join을 호출했는데, 만약 쓰레드 함수내에 wait()호출이 없다면</div><div>t2의 종료를 기다리지 않기 때문에,t2의 실행이 끝나기전에 &nbsp;프로그램이 종료될것이다.</div><div>하지만 wait()호출을 하게 되면 지정된 갯수 2 만큼 호출되기까지 대기하기 때문에 t2의 실행이 완료될수 있다<span style="background-color: white;">.</span></div></span><br /><div style="font-family: arial, helvetica, sans-serif;"></div></div></div><div style="background-color: white; color: #555555; font-family: arial, helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left;"><span style="font-family: Arial, helvetica, sans-serif;"><br /></span></div>