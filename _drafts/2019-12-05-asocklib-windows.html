---
layout: post
title: 'ASockLib windows 지원 '
date: '2019-12-05T23:06:00.001+09:00'
author: jeremyko
tags:
- iocp
modified_time: '2019-12-27T22:31:49.171+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-8296960458209103464
blogger_orig_url: https://jeremyko.blogspot.com/2019/12/asocklib-windows.html
---

<br />ASockLib 를 윈도우에서도 지원하기 위해 IOCP 를 사용하려니까, 여러가지 고려 사항이 생긴다. 서버에서 WSARecv 하고 데이터 받으면 WSASend 하고.. 이렇게 순차적인 경우에는 별 어려움 없이 구현된다. 하지만 이런 단순한 경우말고 만약 서버에서 데이터 수신과 상관없이 수시로 클라이언트들에게 send 하는 경우 혹은 클라이언트에서도 데이터 수신에 상관없이 계속 서버로 send 하는 경우 구현하기가 까다로워진다. IOCP 는 리눅스나&nbsp; os x 의 epoll, kqueue 처럼 수신 신호가 올때마다 수신해서 데이터를 처리하면 되는 방식이 아니라, 중첩 입출력(overlapped IO)개념이라서 내가 발생시킨 WSASend, WSARecv 호출들의 결과가 나중에 통보되기 때문에, 그 결과를 확인하고 적절하게 다음 send ,recv 호출을 해줘야 한다. 리눅스에서 select 나 epoll 호출하는 방식으로 WSARecv 를 계속 호출하는 방식으로 접근하면 동작하지 않는다. 간단한 예를 들어, 서버가 여러번 클라이언트에게 WSASend 를 호출하는 경우, 그리고 그동안 클라이언트도 계속 메시지를 보내는 상황에서 IO 를 어떻게 proactive 하게 발생시켜야 할지가 관건이다.<br /><br /><br />