---
layout: post
title: 내가 본 소스들 - 잘못된 추상화
date: '2014-04-13T20:31:00.002+09:00'
author: jeremyko
tags:
- c++
- 내가 봐온 거지같은 소스들
modified_time: '2020-04-08T16:44:22.809+09:00'
blogger_id: tag:blogger.com,1999:blog-7360229670252766698.post-446997638785599121
blogger_orig_url: https://jeremyko.blogspot.com/2014/04/blog-post.html
---

<span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">지금까지 일한곳들에 존재하는, 기존 소스들을 유지, 보수하면서 느낀점들을 정리한다. &nbsp;</span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span> <span style="color: #0b5394; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><b>잘못된 추상화</b></span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span> <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">추상화란 프로그램이 사용할 객체를 정의하기 위해, 필요한 정보들을 뽑아내는 작업이라고 할수있다. 잘못된 추상화란 객체를 잘못 정의하는것이다.&nbsp;</span><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">예를 들어 데이터베이스 테이블을 위한 객체를 정의한다고 해보자.&nbsp;</span><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">어떤 &nbsp;객체를 정의해야 할까?&nbsp; </span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">일단 각각의 테이블들을 각각의 객체로 정의한다고 가정해보자.&nbsp;</span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span> <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">자.. 여기서&nbsp;내가 실제 겪고 있는 소스를 예로 한번 들어본다. <br /></span> <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">누군가&nbsp;DataFormat &nbsp;테이블을 위해&nbsp;CDataFormat&nbsp;이라는 객체를 정의했다. 그런데 이 객체가 하는일이 무엇이라고 생각되는가? 난 이름만 보고 DataFormat 테이블에서 select 를 통해서 가져오는 데이터 집합을 관리하는 역활을 수행한다고 생각했다 (왜냐면 클래스명이 테이블명과 동일하고, 알다시피 데이터베이스 테이블은 집합의 개념 아닌가?). 그런데 코드를 분석할수록 점점 이해가 힘든 부분이 많아졌다. 그리고 결국 이 소스가 읽기 어려운 원인은 이 클래스가 DataFormat table의 하나의 데이터(1 row) &nbsp;를 위한 객체였다는것을 알게 되었다.</span><br /><a name='more'></a><br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">CDataFormat</span> <span style="color: #888888;">//이게 하나의row를 위함인가 아니면 전체 테이블을 위한것인가???</span><br />{ <br />    <span style="color: #008800; font-weight: bold;">public</span>:<br />        ItemDataFormat Items; <span style="color: #888888;">//이 구조체가 결국 1 row를 위한 정보이다. - - ;</span><br />        <span style="color: #888888;">//그런데 items 라는 복수형으로 정의가 되있다. </span><br />    <span style="color: #888888;">//...</span><br />}<br /><br /><br /><span style="color: #008800; font-weight: bold;">typedef</span> <span style="color: #008800; font-weight: bold;">struct</span> __ItemDataFormat <span style="color: #888888;">//1 row를 위한 정보</span><br />{<br />    <span style="color: #888888; font-weight: bold;">char</span>    strPackageId     [LEN_PACKAGE_ID    +<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    <span style="color: #888888; font-weight: bold;">char</span>    strServiceName   [LEN_SERVICE_NAME  +<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    <span style="color: #888888; font-weight: bold;">char</span>    strGroupName     [LEN_PROCESS_NAME+<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    <span style="color: #888888; font-weight: bold;">char</span>    strComponentType [LEN_COMPONENT_TYPE +<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    <span style="color: #888888; font-weight: bold;">char</span>    strDataName      [LEN_FORMAT_NAME  +<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    <span style="color: #888888; font-weight: bold;">char</span>    strStructureCd   [LEN_STRUCTURE_CD +<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    <span style="color: #888888;">//....</span><br />}ItemDataFormat;<br /></pre></div><br /><br /><br /><pre class="sunburst" style="background-color: white; font-family: 'Bitstream Vera Sans Mono', Inconsolata, Monaco, Consolas, 'Courier New', monospace; font-size: 11px; line-height: 14.300000190734863px; margin-top: 0em;"><span class="meta meta_class-struct-block meta_class-struct-block_c++"><pre class="sunburst" style="font-family: 'Bitstream Vera Sans Mono', Inconsolata, Monaco, Consolas, 'Courier New', monospace; margin-top: 0em;"></pre></span></pre><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">원래 내가 생각했던 테이블의 데이터 집합관리는 &nbsp;CDataFormatVect&nbsp;이라는 클래스명으로 존재했다. &nbsp;약간만 생각을 해볼수만 있다면 대부분의 개발자는 먼저 하나의 row 를 위한&nbsp;DataFormatTableRow 클래스를 정의하고, 이 row들의 집합을 위한&nbsp;DataFormatTable객체를 정의했을 것이다. 이소스에서의 문제를 단순한 네이밍의 문제라고 볼수도 있겠으나 소스를 계속 분석하면서 느낀점은, 결국 잘못된 추상화 였다. 하나의 테이블에 대한 추상화로 객체를 정의하려면 결국 그 테이블의 특징을 객체로 표현해야 한다. 그리고 &nbsp;테이블의 특징은 당연히 개별 데이터들의 집합이다. 하지만 이를 객체 정의에 반영하지 못한 것이다.&nbsp;</span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span> <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이렇듯&nbsp;추상화가 잘못되면 잘못된 클래스를 만들게 되고, 이는 결국 &nbsp;처음 봐서 바로 이해가 안되는 &nbsp;네이밍의 결과로 나타난다. &nbsp;그리고 이것이 단순히 네이밍의 문제가 아니다. 리팩토링한다고 클래스명을 일괄 변경 해도 여전히 이해가 어려운 코드가 남는다. 왜냐면 처음 프로그램 작성 시 부터 객체에 대한 개념과 정의 (즉 추상화) 가 잘못된것이 그대로 나머지 코드에 계속 영향을 준 상태이기 때문에, 이게 단순한 네이밍의 문제로만 남지않게 되는 것이다.&nbsp; 소스는 다음처럼(피곤하게) 계속되고 있다.&nbsp;</span><br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">CDataFormatVect</span> : <span style="color: #008800; font-weight: bold;">public</span> CDataFormat  <br />{<br />    <span style="color: #888888;">//자.. CDataFormatVect 이 클래스가  CDataFormat  데이터 집합을 의미한다.</span><br />    <span style="color: #888888;">//....</span><br />    vector&lt;CDataFormat&gt;    vectDataFormat;<br />}<br /><br /><span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">CStructDataFormat</span> <br />{<br />    <span style="color: #888888;">// 테이블 데이터중에 strStructureCd 라는 항목별 데이터집합(rows) 정의??</span><br />    <span style="color: #888888;">//....</span><br />    <span style="color: #888888; font-weight: bold;">char</span>    strStructCode[LEN_STRUCTURE_CD+<span style="color: #0000dd; font-weight: bold;">1</span>];<br />    CDataFormatVect clsDataVect;<br />};<br /><br /><span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">CStructDataFormatVect</span> <br />{<br />    <span style="color: #888888;">// 어떤 strStructureCd 로 CDataFormat  데이터 집합을 찾는다?</span><br />    <span style="color: #888888;">//....</span><br />    map&lt;string, CStructDataFormat&gt; mapStructVect;<br />    <span style="color: #888888;">//....</span><br />}  <br /></pre></div><br /><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">이러한 객체 정의를 가지고 기존 소스를 보려면, 머리속에서는 부자연스럽고 짜증나는 맵핑을 계속 염두에 두어야 한다. 이 모든 문제의 근본에는 애초부터 잘못된 추상화가 존재하는것이다.&nbsp;</span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span> <br /><div><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">객체를 다음처럼 정의했다면 좀더 이해하기 쉽고 유지하기도 쉬운 코드가 되지 않았을까?</span><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><br /></span> <span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">1. 먼저&nbsp;class&nbsp;CDataFormat ,&nbsp;ItemDataFormat 은&nbsp;&nbsp;DataFormatTableRow 라는 클래스로 통합. 이는 테이블내의 1 row 의 데이터를 의미한다.</span><br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">DataFormatTableRow</span> <br />{<br /><span style="color: #888888; font-weight: bold;">char</span>    strPackageId     [LEN_PACKAGE_ID    +<span style="color: #0000dd; font-weight: bold;">1</span>];<br /><span style="color: #888888; font-weight: bold;">char</span>    strServiceName   [LEN_SERVICE_NAME  +<span style="color: #0000dd; font-weight: bold;">1</span>];<br /><span style="color: #888888; font-weight: bold;">char</span>    strGroupName     [LEN_PROCESS_NAME  +<span style="color: #0000dd; font-weight: bold;">1</span>];<br /><span style="color: #888888; font-weight: bold;">char</span>    strComponentType [LEN_COMPONENT_TYPE+<span style="color: #0000dd; font-weight: bold;">1</span>];<br /><span style="color: #888888; font-weight: bold;">char</span>    strDataName      [LEN_FORMAT_NAME   +<span style="color: #0000dd; font-weight: bold;">1</span>];<br /><span style="color: #888888; font-weight: bold;">char</span>    strStructureCd   [LEN_STRUCTURE_CD  +<span style="color: #0000dd; font-weight: bold;">1</span>];<br /><span style="color: #888888;">//....</span><br />};<br /></pre></div><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">2. CDataFormatVect 클래스는 DataFormatTable 이름으로 재정의.</span><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">DataFormatTable</span><br />{ <br />    <span style="color: #888888;">//....</span><br />    vector&lt;DataFormatTableRow&gt;  vecDataFormatTableRow;<br />};<br /></pre></div><br /><span style="font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;">3. CStructDataFormat , CStructDataFormatVect 이것들이 정말 필요한 객체들인가? 둘을 제거하고 대신, DataFormatTable.hpp 에 다음을 정의한다.</span><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">typedef</span> map&lt;string, DataFormatTable&gt;  MAP_DATA_FORMAT ; <span style="color: #888888;">//key is structure_cd</span><br /></pre></div>이런 소스들을 유지/보수하는일은 정말 힘들다.</div><br /><br />